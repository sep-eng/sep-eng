<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SEP | Your Choice</title>
<meta name="description" content="Minimalist clothing made with intention. Hand-pressed in Copenhagen." />
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/3/3f/Black_square.jpg">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<style>
body {
  font-family:'Inter',sans-serif;
  background:linear-gradient(to bottom,#000,#fff);
  color:#111;
  transition:background .5s,color .5s;
  scroll-behavior:smooth;
}
body.dark {
  background:linear-gradient(to bottom,#fff,#000);
  color:#f2f2f2;
}
h1,h2,h3,p,select,input,button,span {transition:color .5s;}
.theme-text {color:#e6e6e6;transition:color .5s;}
body.dark .theme-text {color:#333;}

button,a{transition:all .25s ease;}
button:hover,a:hover{transform:translateY(-2px);}
#darkToggle{
  position:fixed;bottom:20px;right:20px;z-index:50;
  background:rgba(0,0,0,.5);border-radius:9999px;padding:12px;color:white;
}
#darkToggle svg{width:24px;height:24px;fill:white;}
.popup{
  position:fixed;top:20px;right:20px;
  background:#16a34a;color:#fff;padding:10px 16px;border-radius:8px;
  opacity:0;transition:opacity .3s;z-index:100;
}
.popup.show{opacity:1;}
.fade-section{opacity:0;transform:translateY(30px);}
#cartSidebar{color:#000;transition:background .5s,color .5s;}
body.dark #cartSidebar{background:#111;color:#e6e6e6;}

/* Scenes: only one visible */
.scene{display:none;}
.scene.active{display:block;}

/* Fixed top-right global nav buttons */
#btnSep,#btnSepAbout,#btnMihLogin{
  position:fixed;
  right:16px;
  z-index:55;
  background:rgba(0,0,0,.7);
  color:#fff;
  border-radius:9999px;
  padding:6px 12px;
  font-size:11px;
  border:1px solid rgba(255,255,255,0.2);
}
#btnSep{top:12px;}
#btnSepAbout{top:44px;}
#btnMihLogin{top:76px;}

/* Make it happen cards */
.mih-card{
  background:rgba(255,255,255,0.04);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.12);
  box-shadow:0 18px 45px rgba(0,0,0,0.45);
}
</style>

<script>
window.addEventListener('load',()=>{
  gsap.registerPlugin(ScrollTrigger);
  gsap.utils.toArray('.fade-section').forEach(sec=>{
    gsap.to(sec,{opacity:1,y:0,duration:1,
      scrollTrigger:{trigger:sec,start:'top 80%',once:true}});
  });
});
</script>
</head>

<body>

<!-- GLOBAL NAV BUTTONS (switch scenes only) -->
<button id="btnSep">SEP shop</button>
<button id="btnSepAbout">About SEP</button>
<button id="btnMihLogin">Make it happen</button>

<button id="darkToggle" title="Toggle dark mode">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9h-9V3z"/></svg>
</button>

<!-- ===================== SCENE: SEP SHOP (original, unchanged inside) ===================== -->
<section id="scene-sep-shop" class="scene active">
  <header class="py-20 text-center fade-section">
    <h1 class="theme-text text-5xl font-bold mb-4">Minimalist clothing, made with intention.</h1>
    <p class="theme-text text-lg mb-8">Soft, clean, and hand-pressed in Copenhagen.</p>
    <div class="flex justify-center gap-4">
      <a href="#products" class="bg-white text-black px-6 py-3 rounded-full font-medium">Shop Now</a>
      <button id="viewCartBtn" class="border border-white text-white px-6 py-3 rounded-full font-medium relative">
        View Cart
        <span id="cartCounter" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hidden">0</span>
      </button>
    </div>
  </header>

  <section id="products" class="py-20 px-6 fade-section">
    <div class="text-center mb-12">
      <h2 class="theme-text text-4xl font-bold mb-4">Three products. One choice.</h2>
      <p class="theme-text">Soft, durable, and timeless.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
      <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
        <img src="http://static.photos/textures/1024x576/1" class="w-full h-64 object-cover rounded mb-4" alt="White T-shirt">
        <h3 class="text-xl font-bold mb-2">SEP White T-shirt</h3>
        <p class="mb-2">180 DKK</p>
        <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
          <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option>
        </select>
        <div class="flex justify-center gap-2">
          <input type="number" min="1" value="1" class="theme-text border rounded w-16 text-center bg-transparent quantity-selector">
          <button class="add-to-cart bg-white text-black px-4 py-2 rounded">Add</button>
        </div>
      </div>

      <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
        <img src="http://static.photos/textures/1024x576/2" class="w-full h-64 object-cover rounded mb-4" alt="Black Hoodie">
        <h3 class="text-xl font-bold mb-2">SEP Black Hoodie</h3>
        <p class="mb-2">180 DKK</p>
        <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
          <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option>
        </select>
        <div class="flex justify-center gap-2">
          <input type="number" min="1" value="1" class="theme-text border rounded w-16 text-center bg-transparent quantity-selector">
          <button class="add-to-cart bg-white text-black px-4 py-2 rounded">Add</button>
        </div>
      </div>

      <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
        <img src="http://static.photos/textures/1024x576/3" class="w-full h-64 object-cover rounded mb-4" alt="Black Trousers">
        <h3 class="text-xl font-bold mb-2">SEP Black Trousers</h3>
        <p class="mb-2">180 DKK</p>
        <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
          <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option>
        </select>
        <div class="flex justify-center gap-2">
          <input type="number" min="1" value="1" class="theme-text border rounded w-16 text-center bg-transparent quantity-selector">
          <button class="add-to-cart bg-white text-black px-4 py-2 rounded">Add</button>
        </div>
      </div>
    </div>
  </section>

  <div id="cartSidebar" class="fixed top-0 right-0 h-full w-80 bg-white shadow-xl translate-x-full transition-transform duration-300 z-50 overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold">Your Cart</h3>
        <button id="closeCart">✕</button>
      </div>
      <div id="cartItems" class="space-y-4 text-sm"></div>
      <div class="border-t border-gray-300 pt-4 mt-4">
        <div class="flex justify-between mb-1">
          <span>Subtotal:</span><span id="cartSubtotal" class="font-bold">0 DKK</span>
        </div>
        <div class="flex justify-between mb-2 text-sm text-gray-600">
          <span>Shipping:</span><span>+45 DKK</span>
        </div>
        <div class="flex justify-between font-semibold border-t border-gray-300 pt-2 mb-3">
          <span>Total:</span><span id="cartTotal">45 DKK</span>
        </div>
        <button id="openMobilePay" class="w-full bg-green-500 text-white py-2 rounded mb-2">Open MobilePay</button>
        <p class="text-xs text-gray-500 mb-2 text-center">Open MobilePay button is only a valid link on mobile.</p>
        <button id="copyMobilePay" class="w-full bg-gray-200 py-2 rounded">Copy Order Message</button>
      </div>
    </div>
  </div>
  <div id="cartOverlay" class="fixed inset-0 bg-black/50 hidden z-40"></div>

  <section class="py-20 text-center fade-section">
    <h2 class="text-3xl font-bold mb-10">How to Order</h2>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 max-w-6xl mx-auto text-sm md:text-base">
      <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
        <h3 class="font-bold text-lg mb-2">1. Choose</h3>
        <p>Select your favourite SEP piece — T-shirt, Hoodie, or Trousers — then pick your size and quantity.</p>
      </div>
      <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
        <h3 class="font-bold text-lg mb-2">2. Add to Cart</h3>
        <p>Click “Add” to add your chosen items to your cart. When ready, click “View Cart” to review your order.</p>
      </div>
      <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
        <h3 class="font-bold text-lg mb-2">3. Copy Order Message</h3>
        <p>Inside your cart, press “Copy Order Message”. This copies your full order, including shipping, automatically.</p>
      </div>
      <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
        <h3 class="font-bold text-lg mb-2">4. Pay with MobilePay</h3>
        <p>Send the total amount (incl. +45 DKK shipping. Unless in Copenhagen.) to <b>5894BZ</b> using MobilePay.<br><span class="text-xs italic">“Open MobilePay” works only on mobile devices.</span></p>
      </div>
      <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
        <h3 class="font-bold text-lg mb-2">5. Send us your order</h3>
        <p>DM your copied message to <b>@seproairesis</b> (Instagram) or <b>@se.proairesis</b> (TikTok).<br>We currently deliver within Denmark.</p>
      </div>
    </div>
  </section>

  <footer class="text-center py-10 fade-section">
    <p>© 2025 SEP — Se Proairesis • MobilePay 5894BZ • +45 DKK Shipping (FREE in copenhagen) • Made in Copenhagen. Delivered across Denmark.</p>
    <div class="flex justify-center gap-4 mt-4">
      <a href="https://instagram.com/seproairesis" class="bg-gradient-to-br from-pink-500 to-purple-600 text-white p-3 rounded-full">IG</a>
      <a href="https://tiktok.com/@se.proairesis" class="bg-black text-white p-3 rounded-full">TT</a>
    </div>
  </footer>
</section>
<!-- ================= END SCENE: SEP SHOP ================= -->

<!-- ===================== SCENE: ABOUT SEP ===================== -->
<section id="scene-sep-about" class="scene">
  <div class="min-h-screen bg-black text-white flex items-center justify-center px-6 py-16">
    <div class="max-w-3xl mx-auto space-y-6">
      <h2 class="text-3xl font-bold tracking-wide">About SEP</h2>
      <p class="text-sm md:text-base text-gray-200">
        SEP stands for <span class="italic">Se Proairesis</span> — “Your Choice”. It is a minimalist clothing brand
        built around simple, clean pieces that feel good to wear and last a long time.
      </p>
      <p class="text-sm md:text-base text-gray-300">
        Everything is hand-pressed in Copenhagen, in small batches. No hype drops, no giant collections. Just a white
        T-shirt, a black hoodie and black trousers that you can wear every day.
      </p>
      <p class="text-sm md:text-base text-gray-300">
        SEP is designed to be easy. You pick your size, your quantity, copy your order message and send it. That is the
        entire process.
      </p>
      <p class="text-sm md:text-base text-gray-400">
        And the whole thing — SEP, the idea, and this website — was created and coded by a 13-year-old.
      </p>
      <div class="flex flex-wrap gap-3 text-xs md:text-sm mt-4">
        <button class="px-4 py-2 rounded-full border border-white/20" onclick="showScene('sep-shop')">
          Back to SEP shop
        </button>
        <button class="px-4 py-2 rounded-full border border-white/20" onclick="showScene('mih-login')">
          Go to Make it happen
        </button>
      </div>
    </div>
  </div>
</section>
<!-- ================= END SCENE: ABOUT SEP ================= -->

<!-- ===================== HEADER STRIP FOR MIH SCENES ===================== -->
<!-- (reused in all MIH scenes for consistency) -->
<!-- we will just style each MIH scene with similar top block -->

<!-- ===================== SCENE: MIH LOGIN ===================== -->
<section id="scene-mih-login" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <div id="user-controls" class="flex flex-wrap gap-2 justify-end">
          <span id="user-status">Not logged in</span>
        </div>
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto">
      <div class="mih-card p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-semibold mb-2">Log in to make it happen</h1>
        <p class="text-sm md:text-base text-gray-300 mb-4">
          Create a simple account so the site knows who you are and only you can manage your activities.
        </p>
        <form id="login-form" class="space-y-3 mt-2">
          <div>
            <label for="login-name" class="block text-xs text-gray-400 mb-1">Name</label>
            <input id="login-name" type="text" placeholder="e.g. Daniel"
              class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm" required />
          </div>
          <div>
            <label for="login-password" class="block text-xs text-gray-400 mb-1">Password</label>
            <input id="login-password" type="password" placeholder="Choose something simple"
              class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm" required />
          </div>
          <button type="submit" class="px-5 py-2 rounded-full bg-white text-black text-xs md:text-sm mt-1">
            Log in / Create account
          </button>
          <p class="text-[11px] text-gray-400 mt-2">
            If this is your first time with this name, we’ll create a new account and place you into a league.
          </p>
        </form>
        <p class="text-[11px] text-gray-500 mt-4">
          Your login is saved on this browser. Accounts logged out for more than 30 days are deleted, together with their activities.
        </p>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH LOGIN ================= -->

<!-- ===================== SCENE: MIH WELCOME ===================== -->
<section id="scene-mih-welcome" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <div id="user-controls-2" class="hidden"></div><!-- placeholder, real controls already in login scene -->
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto">
      <div class="mih-card p-6 md:p-8 space-y-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-semibold mb-2">Move more. Compete. Make it happen.</h1>
          <p class="text-sm md:text-base text-gray-300">
            Run, walk or cycle, log your distance, and climb the leaderboard.
          </p>
        </div>
        <div class="flex flex-wrap gap-3">
          <button class="px-5 py-2 rounded-full bg-white text-black text-xs md:text-sm"
                  onclick="requireLoginThenShow('mih-leaderboard')">
            Start logging my distance →
          </button>
          <button class="px-5 py-2 rounded-full border border-white/20 text-xs md:text-sm text-gray-200"
                  onclick="requireLoginThenShow('mih-rules')">
            How it works
          </button>
        </div>
        <div class="flex flex-wrap gap-2 text-[11px] text-gray-300">
          <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">4 leagues: Amateurs, Intermediates, Pros, Legends</span>
          <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">New people are placed where leagues are lightest</span>
          <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">Promotions & relegations keep things moving</span>
        </div>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH WELCOME ================= -->

<!-- ===================== SCENE: MIH LEADERBOARD ===================== -->
<section id="scene-mih-leaderboard" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <div id="user-controls" class="flex flex-wrap gap-2 justify-end">
          <!-- will be filled by JS -->
        </div>
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto space-y-6">
      <div class="mih-card p-6 md:p-8">
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h2 class="text-xl font-semibold mb-2">Add your latest activity</h2>
            <p class="text-sm text-gray-300 mb-3">
              Log any run, walk or ride. Use kilometres and minutes so the leaderboard stays fair for everyone.
            </p>
            <form id="entry-form" class="space-y-3">
              <div>
                <label for="name" class="block text-xs text-gray-400 mb-1">Your name</label>
                <input id="name" type="text" disabled placeholder="Log in to set your name"
                  class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm" />
                <p class="text-[11px] text-gray-500 mt-1">
                  Name comes from your account. You cannot change it here.
                </p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div>
                  <label for="distance" class="block text-xs text-gray-400 mb-1">Distance (km)</label>
                  <input id="distance" type="number" step="0.1" min="0" placeholder="e.g. 5"
                    class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm" required />
                </div>
                <div>
                  <label for="time" class="block text-xs text-gray-400 mb-1">Time (minutes)</label>
                  <input id="time" type="number" step="0.1" min="0" placeholder="e.g. 28"
                    class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm" required />
                </div>
              </div>
              <button type="submit" class="px-5 py-2 rounded-full bg-white text-black text-xs md:text-sm">
                Save my activity
              </button>
              <p class="text-[11px] text-gray-400 mt-2">
                Leagues have unlimited spaces. New accounts are spread across leagues so the numbers stay balanced.
              </p>
            </form>
          </div>

          <div>
            <h3 class="text-lg font-semibold mb-2">How ranking works</h3>
            <p class="text-sm text-gray-300">
              The leaderboard sorts people using three things:
            </p>
            <ul class="text-sm text-gray-300 list-disc list-inside mt-2 space-y-1">
              <li><strong>Total distance</strong> – more kilometres puts you higher.</li>
              <li><strong>Speed</strong> – average km per minute, faster is better.</li>
              <li><strong>Time spent</strong> – if distance and speed are the same, less total time wins.</li>
            </ul>
            <p class="text-xs text-gray-400 mt-3">
              Promotions & relegations are usually applied once a month from the Stats page.
            </p>
          </div>
        </div>
      </div>

      <div class="mih-card p-6 md:p-8">
        <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
          <h2 class="text-xl font-semibold">Live leaderboard</h2>
          <div class="flex items-center gap-2 text-xs text-gray-300">
            <span>League:</span>
            <select id="league-filter"
                    class="px-3 py-1 rounded-full bg-black/40 border border-white/20 text-xs"
                    onchange="renderLeaderboard()">
              <option value="all">All leagues</option>
              <option value="amateurs">Amateurs</option>
              <option value="intermediates">Intermediates</option>
              <option value="pros">Pros</option>
              <option value="legends">Legends</option>
            </select>
          </div>
        </div>
        <div class="overflow-x-auto text-xs md:text-sm">
          <table class="w-full border-collapse min-w-full">
            <thead class="text-gray-400 text-[11px] uppercase tracking-wide border-b border-white/10">
              <tr>
                <th class="py-2 pr-2 text-left">#</th>
                <th class="py-2 px-2 text-left">Participant</th>
                <th class="py-2 px-2 text-left">League</th>
                <th class="py-2 px-2 text-left">Total distance</th>
                <th class="py-2 px-2 text-left">Total time</th>
              </tr>
            </thead>
            <tbody id="leaderboard-body"></tbody>
          </table>
        </div>
        <div id="no-entries" class="text-xs text-gray-400 mt-3">
          No activities yet. Be the first to log a run and grab the number one spot.
        </div>
      </div>

      <div class="mih-card p-6 md:p-8">
        <h3 class="text-lg font-semibold mb-2">My activities</h3>
        <p class="text-xs text-gray-400 mb-3">
          Only the activities from the account you are logged in with are shown here. You can delete them if you make a mistake.
        </p>
        <div class="overflow-x-auto text-xs md:text-sm">
          <table class="w-full border-collapse min-w-full">
            <thead class="text-gray-400 text-[11px] uppercase tracking-wide border-b border-white/10">
              <tr>
                <th class="py-2 pr-2 text-left">Date</th>
                <th class="py-2 px-2 text-left">Distance</th>
                <th class="py-2 px-2 text-left">Time</th>
                <th class="py-2 px-2 text-left"></th>
              </tr>
            </thead>
            <tbody id="my-activities-body"></tbody>
          </table>
        </div>
        <div id="no-my-activities" class="text-xs text-gray-400 mt-3">
          No activities yet for this account.
        </div>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH LEADERBOARD ================= -->

<!-- ===================== SCENE: MIH STATS ===================== -->
<section id="scene-mih-stats" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto">
      <div class="mih-card p-6 md:p-8">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-xl font-semibold">Player stats</h2>
          <button class="px-3 py-1 rounded-full border border-white/20 text-xs text-gray-200"
                  onclick="applyPromotions()">
            Apply promotions now
          </button>
        </div>
        <p class="text-sm text-gray-300 mb-3">
          Every activity builds your personal stats. Promotions and relegations use these stats.
        </p>
        <div class="overflow-x-auto text-xs md:text-sm">
          <table class="w-full border-collapse min-w-full">
            <thead class="text-gray-400 text-[11px] uppercase tracking-wide border-b border-white/10">
              <tr>
                <th class="py-2 px-2 text-left">Participant</th>
                <th class="py-2 px-2 text-left">League</th>
                <th class="py-2 px-2 text-left">Runs</th>
                <th class="py-2 px-2 text-left">Total distance</th>
                <th class="py-2 px-2 text-left">Average distance</th>
                <th class="py-2 px-2 text-left">Best distance</th>
                <th class="py-2 px-2 text-left">Improvement</th>
              </tr>
            </thead>
            <tbody id="stats-body"></tbody>
          </table>
        </div>
        <div id="no-stats" class="text-xs text-gray-400 mt-3">
          Stats will appear as soon as people start logging their activities.
        </div>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH STATS ================= -->

<!-- ===================== SCENE: MIH RULES ===================== -->
<section id="scene-mih-rules" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto">
      <div class="mih-card p-6 md:p-8 space-y-4 text-sm text-gray-200">
        <h2 class="text-xl font-semibold">Rules, leagues and prizes</h2>

        <div>
          <h3 class="font-semibold mb-1">Leagues & starting positions</h3>
          <p class="text-xs text-gray-300 mb-1">There are four leagues:</p>
          <ul class="list-disc list-inside text-xs text-gray-300 space-y-1">
            <li><strong>Amateurs</strong></li>
            <li><strong>Intermediates</strong></li>
            <li><strong>Pros</strong></li>
            <li><strong>Legends</strong></li>
          </ul>
          <p class="text-xs text-gray-300 mt-2">
            New accounts are placed where the leagues have the fewest people, starting from the lowest league. That keeps league sizes balanced.
          </p>
        </div>

        <div>
          <h3 class="font-semibold mb-1">Promotions & relegations</h3>
          <ul class="list-disc list-inside text-xs text-gray-300 space-y-1">
            <li>Leagues have no hard limits. Many people can be in each league.</li>
            <li>Promotions and relegations are usually applied once per month from the Stats page.</li>
            <li>The number of people moved each way depends on total number of players:
              <ul class="list-disc list-inside pl-4 mt-1 space-y-1">
                <li><strong>8+ players</strong> → 1 promotion + 1 relegation</li>
                <li><strong>16+ players</strong> → 2 promotions + 2 relegations</li>
                <li><strong>32+ players</strong> → 3 promotions + 3 relegations</li>
              </ul>
            </li>
            <li>Promotions come from the top of the ranking. Relegations come from the bottom.</li>
            <li>Ranking is based on:
              <ul class="list-disc list-inside pl-4 mt-1 space-y-1">
                <li>Total distance</li>
                <li>Average speed (km per minute)</li>
                <li>Total time (less is better if distance & speed are the same)</li>
              </ul>
            </li>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-1">Prizes</h3>
          <ul class="list-disc list-inside text-xs text-gray-300 space-y-1">
            <li><strong>Monthly:</strong> The person at the top of the table at month-end wins a small prize.</li>
            <li><strong>Yearly:</strong> The person with the strongest overall year wins a bigger prize.</li>
          </ul>
          <p class="text-xs text-gray-400 mt-2">
            Prize details can change over time. The site simply makes it clear who is on top and who is improving fastest.
          </p>
        </div>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH RULES ================= -->

<!-- ===================== SCENE: MIH ABOUT ===================== -->
<section id="scene-mih-about" class="scene">
  <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
    <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">MAKE IT</div>
        <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">SEP</div>
        <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">HAPPEN</div>
      </div>
      <div class="flex flex-wrap gap-2 text-xs md:text-sm">
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-login')">Login</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-welcome')">Welcome</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-leaderboard')">Leaderboard</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-stats')">Stats</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="requireLoginThenShow('mih-rules')">Rules</button>
        <button class="px-3 py-1 rounded-full border border-white/20 text-gray-300" onclick="showScene('mih-about')">About</button>
      </div>
      <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
        <button type="button"
                class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
                onclick="showScene('sep-shop')">
          Back to SEP
        </button>
      </div>
    </div>

    <main class="max-w-5xl mx-auto">
      <div class="mih-card p-6 md:p-8 space-y-4 text-sm text-gray-200">
        <h2 class="text-xl font-semibold mb-2">About “Make it happen”</h2>
        <p>
          “Make it happen” is a simple health challenge for anyone who wants to move a bit more, without paying for
          apps, subscriptions or fancy gear. You just log what you do and watch yourself climb the table.
        </p>
        <p>
          The idea is not to turn people into athletes. It is to make movement feel normal, fun and slightly addictive
          in a good way. Run, walk or cycle, add your distance, and see where you sit in your league.
        </p>
        <p>
          It is built to be:
        </p>
        <ul class="list-disc list-inside space-y-1 text-gray-200">
          <li><strong>For fun</strong> – no pressure, no judgement, just friendly competition.</li>
          <li><strong>For health</strong> – small sessions add up to better sleep, more energy and a clearer head.</li>
          <li><strong>For free</strong> – no paywalls, no data selling, no ads following you around.</li>
        </ul>
        <p>
          Promotions and relegations keep things exciting. Each month, people can move up or down based on how much
          they have done, how fast they moved and how consistent they were.
        </p>
        <p class="text-gray-400">
          And just like SEP, the whole “Make it happen” system — the leagues, the rules and this working prototype —
          was created and coded by a 13-year-old.
        </p>
        <div class="flex flex-wrap gap-3 text-xs md:text-sm mt-2">
          <button class="px-4 py-2 rounded-full border border-white/20" onclick="requireLoginThenShow('mih-leaderboard')">
            Go to leaderboard
          </button>
          <button class="px-4 py-2 rounded-full border border-white/20" onclick="showScene('sep-shop')">
            Back to SEP
          </button>
        </div>
      </div>
    </main>
  </div>
</section>
<!-- ================= END SCENE: MIH ABOUT ================= -->


<!-- ========== SEP CART + MOBILEPAY JS (unchanged) ========== -->
<script>
const body=document.body;
document.getElementById('darkToggle').onclick=()=>body.classList.toggle('dark');

let cart=JSON.parse(localStorage.getItem('cart'))||[];
const cartSidebar=document.getElementById('cartSidebar');
const cartOverlay=document.getElementById('cartOverlay');
const SHIPPING_COST=45;

function updateCart(){
  const items=document.getElementById('cartItems');
  const subtotal=document.getElementById('cartSubtotal');
  const total=document.getElementById('cartTotal');
  items.innerHTML=''; let sum=0;
  if(cart.length===0){
    items.innerHTML='<p class="text-center text-gray-500 py-10">Cart is empty</p>';
    subtotal.textContent='0 DKK';
    total.textContent='45 DKK';
  }else{
    cart.forEach((it,i)=>{
      const price=parseInt(it.price.replace(/\D/g,''))*it.qty; sum+=price;
      items.innerHTML+=`
        <div class="border-b pb-2">
          <div class="flex justify-between"><span>${it.name}</span><span>${price} DKK</span></div>
          <div class="text-gray-500">Size:${it.size} | Qty:${it.qty}</div>
          <button onclick="removeFromCart(${i})" class="text-red-500 text-xs mt-1">Remove</button>
        </div>`;
    });
    subtotal.textContent=sum+' DKK';
    total.textContent=(sum+SHIPPING_COST)+' DKK';
  }
  localStorage.setItem('cart',JSON.stringify(cart));
  updateCounter();
}
function addToCart(n,p,s,q){
  const f=cart.findIndex(i=>i.name===n&&i.size===s);
  if(f>=0) cart[f].qty+=q; else cart.push({name:n,price:p,size:s,qty:q});
  updateCart();
  const popup=document.createElement('div'); popup.className='popup'; popup.textContent='Added to cart';
  document.body.appendChild(popup);
  setTimeout(()=>popup.classList.add('show'),10);
  setTimeout(()=>{popup.classList.remove('show'); setTimeout(()=>popup.remove(),300);},2000);
}
function removeFromCart(i){cart.splice(i,1);updateCart();}
function updateCounter(){
  const c=document.getElementById('cartCounter');
  const t=cart.reduce((s,i)=>s+i.qty,0);
  if(t>0){c.textContent=t; c.classList.remove('hidden');}
  else c.classList.add('hidden');
}
document.querySelectorAll('.add-to-cart').forEach(b=>{
  b.onclick=()=>{
    const card=b.closest('.product-card');
    const name=card.querySelector('h3').textContent;
    const price=card.querySelector('p').textContent;
    const size=card.querySelector('select').value;
    const qty=parseInt(card.querySelector('.quantity-selector').value);
    addToCart(name,price,size,qty);
  };
});
document.getElementById('viewCartBtn').onclick=()=>{
  cartSidebar.classList.remove('translate-x-full');
  cartOverlay.classList.remove('hidden');
};
document.getElementById('closeCart').onclick=closeCart;
cartOverlay.onclick=closeCart;
function closeCart(){
  cartSidebar.classList.add('translate-x-full');
  cartOverlay.classList.add('hidden');
}
updateCart();

const mobilePayNum='5894BZ';
document.getElementById('openMobilePay').onclick=()=>{
  window.location.href='mobilepay://transfer?phone='+mobilePayNum.replace(/\D/g,'');
  alert('Thanks for supporting SEP!');
};
document.getElementById('copyMobilePay').onclick=()=>{
  const subtotal=document.getElementById('cartSubtotal').textContent;
  const total=document.getElementById('cartTotal').textContent;
  const msg=`Hi SEP, here’s my order:\n${cart.map(i=>`${i.qty}× ${i.name} (Size: ${i.size})`).join('\n')}\nSubtotal: ${subtotal}\nShipping: +45 DKK\nTotal: ${total}`;
  navigator.clipboard.writeText(msg);
  const popup=document.createElement('div');
  popup.className='popup';
  popup.textContent='Order message copied!';
  document.body.appendChild(popup);
  setTimeout(()=>popup.classList.add('show'),10);
  setTimeout(()=>{popup.classList.remove('show');setTimeout(()=>popup.remove(),300);},2000);
};
</script>

<!-- ========== GLOBAL SCENE + MIH LOGIC ========== -->
<script>
// GLOBAL SCENE HANDLER
function showScene(name){
  document.querySelectorAll('.scene').forEach(s=>s.classList.remove('active'));
  const target=document.getElementById('scene-'+name);
  if(target) target.classList.add('active');
  window.scrollTo({top:0,left:0,behavior:'instant'});
}

// Top-right buttons
document.getElementById('btnSep').onclick=()=>showScene('sep-shop');
document.getElementById('btnSepAbout').onclick=()=>showScene('sep-about');
document.getElementById('btnMihLogin').onclick=()=>showScene('mih-login');

// MAKE IT HAPPEN DATA / LOGIC
const STORAGE_KEY_ENTRIES = "mih_entries_v4";
const STORAGE_KEY_USERS = "mih_users_v4";
const STORAGE_KEY_CURRENT_USER = "mih_current_user_v4";
const THIRTY_DAYS_MS = 30 * 24 * 60 * 60 * 1000;
const LEAGUES = ["amateurs", "intermediates", "pros", "legends"];

let entries = [];
let users = [];
let currentUser = null;

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
}
function saveEntries() {
  localStorage.setItem(STORAGE_KEY_ENTRIES, JSON.stringify(entries));
}
function saveUsers() {
  localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(users));
}
function loadEntries() {
  const saved = localStorage.getItem(STORAGE_KEY_ENTRIES);
  if (saved) {
    try { entries = JSON.parse(saved) || []; }
    catch (e) { entries = []; }
  } else { entries = []; }
}
function loadUsers() {
  const saved = localStorage.getItem(STORAGE_KEY_USERS);
  if (saved) {
    try { users = JSON.parse(saved) || []; }
    catch (e) { users = []; }
  } else { users = []; }
  users.forEach((u) => {
    if (!u.league || !LEAGUES.includes(u.league)) {
      u.league = "amateurs";
    }
  });
  saveUsers();
}
function getUserById(id) {
  return users.find((u) => u.id === id) || null;
}
function getUserByName(name) {
  return users.find((u) => u.name.toLowerCase() === name.toLowerCase()) || null;
}
function formatImprovement(value) {
  if (!isFinite(value) || value === 0) return "0%";
  const rounded = Math.round(value);
  return (rounded > 0 ? "+" : "") + rounded + "%";
}
function formatDate(ts) {
  const d = new Date(ts);
  if (isNaN(d.getTime())) return "";
  return d.toLocaleDateString(undefined, {
    year: "numeric",
    month: "short",
    day: "numeric"
  });
}
function leagueIndex(league) {
  return LEAGUES.indexOf(league);
}
function assignStartingLeague() {
  const counts = {
    amateurs: 0,
    intermediates: 0,
    pros: 0,
    legends: 0
  };
  users.forEach((u) => {
    if (u.league && counts.hasOwnProperty(u.league)) {
      counts[u.league]++;
    }
  });
  const values = Object.values(counts);
  const minCount = Math.min(...values);
  const candidateLeagues = LEAGUES.filter((l) => counts[l] === minCount);
  return candidateLeagues[0] || "amateurs";
}
function cleanupOldAccounts() {
  const now = Date.now();
  const currentUserId = localStorage.getItem(STORAGE_KEY_CURRENT_USER);

  const keptUsers = [];
  const removedUserIds = new Set();

  users.forEach((user) => {
    const isCurrent = currentUserId && user.id === currentUserId;
    if (!user.lastLogoutAt || isCurrent) {
      keptUsers.push(user);
      return;
    }
    const delta = now - user.lastLogoutAt;
    if (delta > THIRTY_DAYS_MS) {
      removedUserIds.add(user.id);
    } else {
      keptUsers.push(user);
    }
  });

  users = keptUsers;

  if (removedUserIds.size > 0) {
    entries = entries.filter((e) => !removedUserIds.has(e.userId));
  }

  saveUsers();
  saveEntries();
}

function getPlayerStats() {
  const byUser = {};

  users.forEach((user) => {
    const key = user.id;
    byUser[key] = {
      userId: user.id,
      name: user.name,
      league: user.league || "amateurs",
      runs: 0,
      totalDistance: 0,
      totalTime: 0,
      bestDistance: 0,
      baselineDistance: null
    };
  });

  entries.forEach((e) => {
    const user = getUserById(e.userId);
    if (!user) return;
    const key = user.id;
    const stats = byUser[key];
    if (stats.baselineDistance === null) {
      stats.baselineDistance = e.distanceKm;
    }
    stats.runs += 1;
    stats.totalDistance += e.distanceKm;
    stats.totalTime += e.timeMinutes;
    if (e.distanceKm > stats.bestDistance) {
      stats.bestDistance = e.distanceKm;
    }
  });

  let players = Object.values(byUser);

  players.forEach((p) => {
    p.avgDistance = p.runs > 0 ? p.totalDistance / p.runs : 0;
    p.speed = p.totalTime > 0 ? p.totalDistance / p.totalTime : 0;
    let improvement = 0;
    if (p.baselineDistance && p.baselineDistance > 0 && p.runs > 1) {
      improvement = ((p.avgDistance - p.baselineDistance) / p.baselineDistance) * 100;
    }
    p.improvement = improvement;
  });

  players.sort((a, b) => {
    if (b.totalDistance !== a.totalDistance) {
      return b.totalDistance - a.totalDistance;
    }
    if (b.speed !== a.speed) {
      return b.speed - a.speed;
    }
    return a.totalTime - b.totalTime;
  });

  players = players.map((p, index) => ({
    ...p,
    rank: index + 1
  }));

  return players;
}

function applyPromotions() {
  const players = getPlayerStats();
  const total = players.length;
  if (total === 0) {
    alert("No players yet.");
    return;
  }

  let moves = 0;
  if (total >= 32) moves = 3;
  else if (total >= 16) moves = 2;
  else if (total >= 8) moves = 1;
  else moves = 0;

  if (moves === 0) {
    alert("Not enough players yet. You need at least 8 players for promotions and relegations.");
    return;
  }

  let promoted = 0;
  for (let i = 0; i < players.length && promoted < moves; i++) {
    const p = players[i];
    const idx = leagueIndex(p.league);
    if (idx < 0 || idx >= LEAGUES.length - 1) continue;
    const user = getUserById(p.userId);
    if (!user) continue;
    user.league = LEAGUES[idx + 1];
    promoted++;
  }

  let relegated = 0;
  for (let i = players.length - 1; i >= 0 && relegated < moves; i--) {
    const p = players[i];
    const idx = leagueIndex(p.league);
    if (idx <= 0) continue;
    const user = getUserById(p.userId);
    if (!user) continue;
    user.league = LEAGUES[idx - 1];
    relegated++;
  }

  saveUsers();
  renderHeaderUser();
  renderLeaderboard();
  renderStats();
  alert(`Promotions and relegations applied: ${moves} up, ${moves} down.`);
}

function renderHeaderUser() {
  const el = document.getElementById("user-controls");
  const nameInput = document.getElementById("name");
  if (!el) return;

  el.innerHTML = "";
  if (!currentUser) {
    const statusSpan = document.createElement("span");
    statusSpan.id = "user-status";
    statusSpan.textContent = "Not logged in";
    el.appendChild(statusSpan);

    const btn = document.createElement("button");
    btn.className = "px-3 py-1 rounded-full border border-white/20 text-[11px] text-gray-300";
    btn.textContent = "Log in";
    btn.onclick = () => showScene("mih-login");
    el.appendChild(btn);

    if (nameInput) {
      nameInput.value = "";
      nameInput.placeholder = "Log in to set your name";
    }
    return;
  }

  const statusSpan = document.createElement("span");
  statusSpan.id = "user-status";
  statusSpan.innerHTML =
    `Logged in as <span class="user-name font-semibold">${currentUser.name}</span> · ` +
    `<span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">` +
    `${currentUser.league.charAt(0).toUpperCase() + currentUser.league.slice(1)}</span>`;
  el.appendChild(statusSpan);

  const logoutBtn = document.createElement("button");
  logoutBtn.className = "px-3 py-1 rounded-full border border-white/20 text-[11px] text-gray-300";
  logoutBtn.textContent = "Log out";
  logoutBtn.onclick = logout;
  el.appendChild(logoutBtn);

  const deleteBtn = document.createElement("button");
  deleteBtn.className = "px-3 py-1 rounded-full border border-red-400/60 text-[11px] text-red-200";
  deleteBtn.textContent = "Delete account";
  deleteBtn.onclick = deleteAccount;
  el.appendChild(deleteBtn);

  if (nameInput) {
    nameInput.value = currentUser.name;
    nameInput.placeholder = "";
  }
}

function renderLeaderboard() {
  const tbody = document.getElementById("leaderboard-body");
  const empty = document.getElementById("no-entries");
  if (!tbody) return;

  tbody.innerHTML = "";
  const players = getPlayerStats();
  const filterEl = document.getElementById("league-filter");
  const filter = filterEl ? filterEl.value : "all";

  let filtered = players;
  if (filter !== "all") {
    filtered = players.filter((p) => p.league === filter);
  }

  if (!filtered.length) {
    if (empty) empty.style.display = "block";
    return;
  }
  if (empty) empty.style.display = "none";

  filtered.forEach((player) => {
    const tr = document.createElement("tr");
    tr.className = "border-b border-white/10";

    let rankSymbol = player.rank;
    if (player.rank === 1) rankSymbol = "🥇";
    else if (player.rank === 2) rankSymbol = "🥈";
    else if (player.rank === 3) rankSymbol = "🥉";

    tr.innerHTML = `
      <td class="py-2 pr-2">${rankSymbol}</td>
      <td class="py-2 px-2">${player.name}</td>
      <td class="py-2 px-2">
        <span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">
          ${player.league.charAt(0).toUpperCase() + player.league.slice(1)}
        </span>
      </td>
      <td class="py-2 px-2">${player.totalDistance.toFixed(2)} km</td>
      <td class="py-2 px-2">${player.totalTime.toFixed(1)} min</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderStats() {
  const tbody = document.getElementById("stats-body");
  const empty = document.getElementById("no-stats");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!users.length) {
    if (empty) empty.style.display = "block";
    return;
  }
  if (empty) empty.style.display = "none";

  const players = getPlayerStats();

  players.forEach((stats) => {
    const tr = document.createElement("tr");
    tr.className = "border-b border-white/10";
    tr.innerHTML = `
      <td class="py-2 px-2">${stats.name}</td>
      <td class="py-2 px-2">
        <span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">
          ${stats.league.charAt(0).toUpperCase() + stats.league.slice(1)}</span></td>
      <td class="py-2 px-2">${stats.runs}</td>
      <td class="py-2 px-2">${stats.totalDistance.toFixed(2)} km</td>
      <td class="py-2 px-2">${stats.avgDistance.toFixed(2)} km</td>
      <td class="py-2 px-2">${stats.bestDistance.toFixed(2)} km</td>
      <td class="py-2 px-2">${formatImprovement(stats.improvement)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderMyActivities() {
  const tbody = document.getElementById("my-activities-body");
  const empty = document.getElementById("no-my-activities");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!currentUser) {
    if (empty) {
      empty.style.display = "block";
      empty.textContent = "Log in to see and manage your activities.";
    }
    return;
  }

  const myEntries = entries.filter((e) => e.userId === currentUser.id);

  if (!myEntries.length) {
    if (empty) {
      empty.style.display = "block";
      empty.textContent = "No activities yet for this account.";
    }
    return;
  }
  if (empty) empty.style.display = "none";

  myEntries
    .slice()
    .sort((a, b) => b.timestamp - a.timestamp)
    .forEach((e) => {
      const tr = document.createElement("tr");
      tr.className = "border-b border-white/10";
      tr.innerHTML = `
        <td class="py-2 px-2">${formatDate(e.timestamp)}</td>
        <td class="py-2 px-2">${e.distanceKm.toFixed(2)} km</td>
        <td class="py-2 px-2">${e.timeMinutes.toFixed(1)} min</td>
        <td class="py-2 px-2 text-right">
          <button class="text-[11px] text-red-300 underline" onclick="deleteActivity('${e.id}')">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
}

function deleteActivity(id) {
  if (!currentUser) {
    alert("You need to be logged in to delete activities.");
    return;
  }
  const entry = entries.find((e) => e.id === id);
  if (!entry) return;
  if (entry.userId !== currentUser.id) {
    alert("You can only delete your own activities.");
    return;
  }
  if (!confirm("Delete this activity?")) return;

  entries = entries.filter((e) => e.id !== id);
  saveEntries();
  renderLeaderboard();
  renderStats();
  renderMyActivities();
}

function login(name, password) {
  const trimmedName = name.trim();
  if (!trimmedName || !password) {
    alert("Please enter both name and password.");
    return;
  }

  const existing = getUserByName(trimmedName);

  if (!existing) {
    const newLeague = assignStartingLeague();
    const newUser = {
      id: generateId(),
      name: trimmedName,
      password,
      league: newLeague,
      createdAt: Date.now(),
      lastLoginAt: Date.now(),
      lastLogoutAt: null
    };
    users.push(newUser);
    currentUser = newUser;
    saveUsers();
    localStorage.setItem(STORAGE_KEY_CURRENT_USER, newUser.id);
    renderHeaderUser();
    showScene("mih-welcome");
    return;
  }

  if (existing.password !== password) {
    alert("Wrong password for this name.");
    return;
  }

  existing.lastLoginAt = Date.now();
  if (!existing.league || !LEAGUES.includes(existing.league)) {
    existing.league = "amateurs";
  }
  currentUser = existing;
  saveUsers();
  localStorage.setItem(STORAGE_KEY_CURRENT_USER, existing.id);
  renderHeaderUser();
  showScene("mih-welcome");
}

function logout() {
  if (!currentUser) return;
  const user = getUserById(currentUser.id);
  if (user) {
    user.lastLogoutAt = Date.now();
  }
  saveUsers();
  localStorage.removeItem(STORAGE_KEY_CURRENT_USER);
  currentUser = null;
  renderHeaderUser();
  renderMyActivities();
  showScene("mih-login");
}

function deleteAccount() {
  if (!currentUser) return;
  const confirmText = "This will delete your account and all your activities. Are you sure?";
  if (!confirm(confirmText)) return;

  const userId = currentUser.id;
  users = users.filter((u) => u.id !== userId);
  entries = entries.filter((e) => e.userId !== userId);

  saveUsers();
  saveEntries();
  localStorage.removeItem(STORAGE_KEY_CURRENT_USER);
  currentUser = null;
  renderHeaderUser();
  renderLeaderboard();
  renderStats();
  renderMyActivities();
  showScene("mih-login");
}

// FORM HANDLERS
const loginForm = document.getElementById("login-form");
if (loginForm) {
  loginForm.addEventListener("submit", function (e) {
    e.preventDefault();
    const name = document.getElementById("login-name").value;
    const password = document.getElementById("login-password").value;
    login(name, password);
    loginForm.reset();
  });
}

const entryForm = document.getElementById("entry-form");
if (entryForm) {
  entryForm.addEventListener("submit", function (e) {
    e.preventDefault();
    if (!currentUser) {
      alert("Please log in before adding activities.");
      showScene("mih-login");
      return;
    }
    const distance = parseFloat(document.getElementById("distance").value);
    const time = parseFloat(document.getElementById("time").value);

    if (isNaN(distance) || isNaN(time)) {
      alert("Please fill in distance and time correctly.");
      return;
    }
    if (distance <= 0 || time <= 0) {
      alert("Distance and time must be bigger than zero.");
      return;
    }

    entries.push({
      id: generateId(),
      userId: currentUser.id,
      distanceKm: distance,
      timeMinutes: time,
      timestamp: Date.now()
    });

    saveEntries();
    renderLeaderboard();
    renderStats();
    renderMyActivities();

    entryForm.reset();
    showScene("mih-leaderboard");
  });
}

function requireLoginThenShow(name) {
  if (!currentUser) {
    alert("Please log in first.");
    showScene("mih-login");
    return;
  }
  showScene(name);
}

// INIT
function initMIH() {
  loadEntries();
  loadUsers();
  cleanupOldAccounts();

  const currentUserId = localStorage.getItem(STORAGE_KEY_CURRENT_USER);
  if (currentUserId) {
    const user = getUserById(currentUserId);
    if (user) {
      currentUser = user;
    } else {
      localStorage.removeItem(STORAGE_KEY_CURRENT_USER);
      currentUser = null;
    }
  }

  renderHeaderUser();
  renderLeaderboard();
  renderStats();
  renderMyActivities();
}
initMIH();
</script>

</body>
</html>
