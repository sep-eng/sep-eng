<!-- ===========================
  PART 1/10 – BASIC HTML & STYLES
=========================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>9-5 to Business (Prototype)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #eee;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
    }

    #gameCanvas {
      margin-top: 10px;
      border: 2px solid #555;
      image-rendering: pixelated;
      background: #222;
    }

    #inputArea {
      margin-top: 8px;
      width: 960px;
      display: flex;
      gap: 4px;
    }

    #playerInput {
      flex: 1;
      padding: 6px;
      font-family: monospace;
      font-size: 14px;
      background: #000;
      color: #0f0;
      border: 1px solid #555;
    }

    #sendBtn {
      padding: 6px 12px;
      font-family: monospace;
      background: #333;
      color: #eee;
      border: 1px solid #666;
      cursor: pointer;
    }

    #inputArea.hidden {
      display: none;
    }

    canvas {
      cursor: default;
    }
  </style>
</head>
<body>

  <!-- ===========================
    PART 2/10 – CANVAS & INPUT UI
  =========================== -->

  <canvas id="gameCanvas" width="960" height="540"></canvas>

  <div id="inputArea" class="hidden">
    <input id="playerInput" type="text" placeholder="Type what you say to the NPC..." />
    <button id="sendBtn">Send</button>
  </div>

  <script>
  // ===========================
  // PART 3/10 – CONSTANTS & UTILITIES
  // ===========================

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const inputArea = document.getElementById('inputArea');
  const playerInput = document.getElementById('playerInput');
  const sendBtn = document.getElementById('sendBtn');

  const GAME_STATE = {
    INTRO: 'intro',
    EMPLOYEE_DAY: 'employee_day',
    LUNCH_BREAK: 'lunch_break',
    CALL: 'call',
    RULES: 'rules',
    OWNER_DAY: 'owner_day',
    SHOP: 'shop',
    GAME_OVER: 'game_over',
  };

  const PHASE = {
    EMPLOYEE: 'employee',
    OWNER: 'owner',
  };

  const WORKDAY_EMPLOYEE_START = { hour: 9, minute: 0 };
  const WORKDAY_EMPLOYEE_END   = { hour: 17, minute: 0 };
  const WORKDAY_OWNER_START    = { hour: 10, minute: 0 };

  // 1 real second = 1 in-game minute
  const MS_PER_GAME_MINUTE = 1000;

  function cloneTime(t) {
    return { hour: t.hour, minute: t.minute };
  }

  function advanceTime(time, minutes) {
    time.minute += minutes;
    while (time.minute >= 60) {
      time.minute -= 60;
      time.hour += 1;
    }
  }

  function timeGreaterOrEqual(a, b) {
    if (a.hour > b.hour) return true;
    if (a.hour < b.hour) return false;
    return a.minute >= b.minute;
  }

  function timeToString(t) {
    const hh = String(t.hour).padStart(2, '0');
    const mm = String(t.minute).padStart(2, '0');
    return `${hh}:${mm}`;
  }

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function randChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // ===========================
  // PART 4/10 – CORE GAME STATE
  // ===========================

  const game = {
    phase: PHASE.EMPLOYEE,
    state: GAME_STATE.INTRO,
    currentTime: cloneTime(WORKDAY_EMPLOYEE_START),
    lastMinuteMs: 0,
    dayNumber: 1,

    money: 0,
    reputation: 50,
    warnings: [],      // store days when warnings happened (owner phase)

    hasHadLunchToday: false,

    // Call-related
    isInCall: false,
    callLog: [],
    callNPCMood: 0,
    callProduct: null,
    callStep: 0,

    // Shop / inventory / employees (owner phase)
    inventory: [], // { id, name, buyPrice, sellPrice, difficulty, stock }
    availableProducts: [],
    availableEmployees: [],
    employees: [], // { id, name, dailyCost, skill }

    // Game over info
    gameOverReason: '',
  };

  // Employee-phase products
  const EMPLOYEE_PRODUCTS = [
    { id: 'printer',       name: 'Office Printer',     price: 200,  difficulty: 1, repGain: 3,  repLoss: 2 },
    { id: 'software',      name: 'Software License',   price: 500,  difficulty: 2, repGain: 5,  repLoss: 4 },
    { id: 'gaming_pc',     name: 'High-End Gaming PC', price: 1200, difficulty: 3, repGain: 9,  repLoss: 7 },
    { id: 'military_pc',   name: 'Military Grade PC',  price: 3000, difficulty: 4, repGain: 15, repLoss: 12},
  ];

  let nextProductId = 1;
  let nextEmployeeId = 1;

  // ===========================
  // PART 5/10 – RENDERING HELPERS & BUTTONS
  // ===========================

  const clickRegions = []; // { x, y, w, h, onClick }

  function addClickRegion(x, y, w, h, onClick) {
    clickRegions.push({ x, y, w, h, onClick });
  }

  function drawButton(x, y, w, h, label) {
    ctx.fillStyle = '#333';
    ctx.fillRect(x, y, w, h);
    ctx.strokeStyle = '#777';
    ctx.strokeRect(x, y, w, h);
    ctx.fillStyle = '#eee';
    ctx.font = '16px monospace';
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'left';
    ctx.fillText(label, x + 10, y + h / 2);
  }

  function drawHUD() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, 40);

    ctx.fillStyle = '#0f0';
    ctx.font = '16px monospace';
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'left';

    ctx.fillText(`Day: ${game.dayNumber}`, 10, 20);
    ctx.fillText(`Time: ${timeToString(game.currentTime)}`, 140, 20);
    ctx.fillText(`Money: $${game.money.toFixed(2)}`, 320, 20);
    ctx.fillText(`Reputation: ${game.reputation}`, 580, 20);

    if (game.phase === PHASE.OWNER && game.warnings.length > 0) {
      ctx.fillStyle = '#ff0';
      ctx.fillText(`Warnings (last 7 days): ${game.warnings.length}`, 780, 20);
    }
  }

  function drawIntro() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#444';
    for (let y = 80; y <= 360; y += 80) {
      for (let x = 80; x <= 880; x += 160) {
        ctx.fillRect(x - 60, y - 30, 120, 60);
      }
    }

    // highlight player cubicle
    ctx.fillStyle = '#666';
    ctx.fillRect(440, 210, 120, 60);

    ctx.fillStyle = '#eee';
    ctx.font = '20px monospace';
    ctx.textAlign = 'center';

    ctx.fillText('You are tired of working a 9-5.', canvas.width / 2, 420);
    ctx.fillText('Make enough money to start your own business.', canvas.width / 2, 450);
    ctx.fillText('Good luck!', canvas.width / 2, 480);

    drawButton(canvas.width / 2 - 80, 500 - 30, 160, 30, 'Start');
    addClickRegion(canvas.width / 2 - 80, 500 - 30, 160, 30, () => {
      startNewDayEmployee();
      game.state = GAME_STATE.EMPLOYEE_DAY;
    });
  }

  function drawEmployeeOffice() {
    ctx.fillStyle = '#222';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    ctx.fillStyle = '#444';
    ctx.fillRect(50, 100, 860, 350);

    // Computer
    ctx.fillStyle = '#111';
    ctx.fillRect(200, 130, 400, 250);
    ctx.fillStyle = '#333';
    ctx.fillRect(210, 140, 380, 230);

    // Phone
    ctx.fillStyle = '#222';
    ctx.fillRect(640, 200, 80, 40);

    // Screen text
    ctx.fillStyle = '#0f0';
    ctx.font = '18px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('> Make a sales call', 230, 180);
    ctx.fillText('> Rules', 230, 210);

    addClickRegion(220, 180, 280, 24, () => {
      startCallSelection();
    });

    addClickRegion(220, 210, 100, 24, () => {
      game.state = GAME_STATE.RULES;
    });
  }

  function drawOwnerOffice() {
    ctx.fillStyle = '#232';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    ctx.fillStyle = '#454';
    ctx.fillRect(50, 100, 860, 350);

    // new computer
    ctx.fillStyle = '#111';
    ctx.fillRect(220, 120, 420, 260);
    ctx.fillStyle = '#333';
    ctx.fillRect(230, 130, 400, 240);

    ctx.fillStyle = '#0f0';
    ctx.font = '18px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('> Make a sales call', 250, 160);
    ctx.fillText('> Shop', 250, 190);
    ctx.fillText('> Rules', 250, 220);
    ctx.fillText('> Finish work day', 250, 250);

    addClickRegion(240, 160, 260, 24, () => startCallSelection());
    addClickRegion(240, 190, 100, 24, () => {
      game.state = GAME_STATE.SHOP;
      generateShopIfEmpty();
    });
    addClickRegion(240, 220, 100, 24, () => {
      game.state = GAME_STATE.RULES;
    });
    addClickRegion(240, 250, 200, 24, () => {
      endOfDay();
    });
  }

  function drawLunchBreak() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = '32px monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('Lunch break', canvas.width / 2, canvas.height / 2);
  }

  function drawRules() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);
    ctx.fillStyle = '#eee';
    ctx.font = '16px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';

    const lines = [];
    if (game.phase === PHASE.EMPLOYEE) {
      lines.push('EMPLOYEE RULES:');
      lines.push('- Work from 09:00 to 17:00, with a lunch break at 12:00.');
      lines.push('- 1 real second = 1 in-game minute.');
      lines.push('- Start with reputation 50/100.');
      lines.push('- If reputation goes below 0, you get fired and lose the game.');
      lines.push('- Company takes 60% of each sale.');
      lines.push('- The remaining 40% that reaches your bank is taxed at 35%.');
      lines.push('- End of each day you pay: $20 rent, $20 food, $5 water/electricity.');
      lines.push('- Get your own business by: reputation > 100 OR earning $5,000.');
      lines.push('- When you start your own business you only keep $1,000 of that money.');
    } else {
      lines.push('BUSINESS OWNER RULES:');
      lines.push('- No more fixed 9-5. You start at 10:00 and end when you choose.');
      lines.push('- No lunch break.');
      lines.push('- No company cut. You keep 100% gross, but pay 45% tax.');
      lines.push('- Use the Shop to restock products and hire employees.');
      lines.push('- Employees have a daily cost that adds to your bills.');
      lines.push('- If you cannot pay your daily bills, you get a warning.');
      lines.push('- If you get 3 warnings within 7 days, you lose the game.');
      lines.push('- If reputation reaches 0 as an owner, you go bankrupt,');
      lines.push('  lose all money, and go back to working for the company.');
    }

    let y = 60;
    for (const line of lines) {
      ctx.fillText(line, 40, y);
      y += 20;
    }

    drawButton(40, canvas.height - 60, 140, 30, 'Back');
    addClickRegion(40, canvas.height - 60, 140, 30, () => {
      game.state = (game.phase === PHASE.EMPLOYEE) ? GAME_STATE.EMPLOYEE_DAY : GAME_STATE.OWNER_DAY;
    });
  }

  function drawGameOver() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#f00';
    ctx.font = '32px monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 40);

    ctx.fillStyle = '#fff';
    ctx.font = '18px monospace';
    ctx.fillText(game.gameOverReason, canvas.width / 2, canvas.height / 2);

    drawButton(canvas.width / 2 - 80, canvas.height / 2 + 60, 160, 30, 'Restart');
    addClickRegion(canvas.width / 2 - 80, canvas.height / 2 + 60, 160, 30, () => {
      resetGame();
    });
  }

  // ===========================
  // PART 6/10 – SALES CALL UI & LOGIC
  // ===========================

  function startCallSelection() {
    game.state = GAME_STATE.CALL;
    game.isInCall = false;
    game.callLog = [];
    game.callNPCMood = 0;
    game.callProduct = null;
    game.callStep = 0;
    hideInput();
  }

  function drawCallScreen() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    if (!game.callProduct) {
      ctx.fillStyle = '#eee';
      ctx.font = '18px monospace';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('Choose what to sell:', 40, 60);

      const products = (game.phase === PHASE.EMPLOYEE)
        ? EMPLOYEE_PRODUCTS
        : game.inventory.filter(p => p.stock > 0);

      if (products.length === 0 && game.phase === PHASE.OWNER) {
        ctx.fillText('You have no stock. Go to the Shop and restock.', 40, 100);
        drawButton(40, canvas.height - 60, 140, 30, 'Back');
        addClickRegion(40, canvas.height - 60, 140, 30, () => {
          game.state = (game.phase === PHASE.EMPLOYEE) ? GAME_STATE.EMPLOYEE_DAY : GAME_STATE.OWNER_DAY;
        });
        return;
      }

      let y = 100;
      for (const p of products) {
        const label = game.phase === PHASE.EMPLOYEE
          ? `${p.name} ($${p.price})`
          : `${p.name} (Stock: ${p.stock}, Sell: $${p.sellPrice})`;
        drawButton(40, y, 400, 30, label);
        addClickRegion(40, y, 400, 30, () => {
          startCallWithProduct(p);
        });
        y += 40;
      }

      drawButton(500, canvas.height - 60, 140, 30, 'Back');
      addClickRegion(500, canvas.height - 60, 140, 30, () => {
        game.state = (game.phase === PHASE.EMPLOYEE) ? GAME_STATE.EMPLOYEE_DAY : GAME_STATE.OWNER_DAY;
      });
    } else {
      ctx.fillStyle = '#eee';
      ctx.font = '16px monospace';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';

      ctx.fillText(`Calling about: ${game.callProduct.name}`, 40, 60);

      // Dialogue box
      ctx.fillStyle = '#222';
      ctx.fillRect(40, 100, 430, 360);
      ctx.strokeStyle = '#555';
      ctx.strokeRect(40, 100, 430, 360);

      let y = 110;
      for (const line of game.callLog.slice(-12)) {
        ctx.fillStyle = (line.from === 'npc') ? '#0ff' : '#0f0';
        ctx.fillText((line.from === 'npc' ? 'NPC: ' : 'YOU: ') + line.text, 50, y);
        y += 20;
      }

      // Info box
      ctx.fillStyle = '#222';
      ctx.fillRect(500, 100, 420, 160);
      ctx.strokeStyle = '#555';
      ctx.strokeRect(500, 100, 420, 160);

      ctx.fillStyle = '#eee';
      ctx.fillText('Type anything in the box below and press "Send".', 510, 110);
      ctx.fillText('The NPC will respond based on what you say.', 510, 130);
      ctx.fillText('Close the deal to earn money and reputation.', 510, 150);

      drawButton(500, canvas.height - 60, 140, 30, 'Hang up');
      addClickRegion(500, canvas.height - 60, 140, 30, () => {
        endCall(false, true);
      });
    }
  }

  function startCallWithProduct(product) {
    game.callProduct = product;
    game.callLog = [];
    game.callNPCMood = 0;
    game.callStep = 0;
    game.isInCall = true;
    showInput();

    const talkChance = Math.max(5, Math.min(95, game.reputation));
    if (Math.random() * 100 > talkChance) {
      game.callLog.push({ from: 'npc', text: 'They hang up immediately.' });
      game.isInCall = false;
      hideInput();
    } else {
      game.callLog.push({ from: 'npc', text: 'Hello? What are you calling about?' });
    }
  }

  function handlePlayerMessage(text) {
    if (!game.isInCall || !game.callProduct) return;
    if (!text.trim()) return;
    game.callLog.push({ from: 'player', text });

    const lower = text.toLowerCase();
    let response = '';

    if (lower.includes('discount') || lower.includes('price')) {
      response = 'The price matters a lot to us. What can you offer?';
      game.callNPCMood += 0;
    } else if (lower.includes('quality') || lower.includes('best')) {
      response = 'We do care about quality. Tell me more.';
      game.callNPCMood += 1;
    } else if (lower.includes('refund') || lower.includes('guarantee')) {
      response = 'A guarantee sounds reassuring.';
      game.callNPCMood += 1;
    } else if (lower.includes('buy now') || lower.includes('today')) {
      response = 'You are a bit pushy, but I\'m listening.';
      game.callNPCMood -= 1;
    } else {
      response = randChoice([
        'Hmm, I see.',
        'Could you explain that a bit more?',
        'I\'m not sure yet.',
        'That sounds interesting.'
      ]);
    }

    game.callLog.push({ from: 'npc', text: response });
    game.callStep++;

    if (game.callStep >= 3) {
      concludeCall();
    }
  }

  function concludeCall() {
    if (!game.callProduct) return;

    const diff = game.callProduct.difficulty || 1;
    let successChance = 70 - diff * 12;

    successChance += Math.floor(game.reputation / 20);
    successChance += game.callNPCMood * 5;
    successChance = Math.max(5, Math.min(95, successChance));

    const roll = Math.random() * 100;
    const success = roll < successChance;

    endCall(success, false);
  }

  function endCall(success, forcedHangup) {
    if (!game.callProduct) {
      game.isInCall = false;
      hideInput();
      return;
    }

    if (!game.isInCall && !forcedHangup) {
      hideInput();
      return;
    }

    if (success) {
      game.callLog.push({ from: 'npc', text: 'Okay, we will take it.' });
      applySaleSuccess(game.callProduct);
    } else {
      if (!forcedHangup) {
        game.callLog.push({ from: 'npc', text: 'Sorry, not interested.' });
      } else {
        game.callLog.push({ from: 'npc', text: 'Click.' });
      }
      applySaleFailure(game.callProduct);
    }

    game.isInCall = false;
    hideInput();
    game.callProduct = null;

    setTimeout(() => {
      game.state = (game.phase === PHASE.EMPLOYEE) ? GAME_STATE.EMPLOYEE_DAY : GAME_STATE.OWNER_DAY;
    }, 800);
  }

  function showInput() {
    inputArea.classList.remove('hidden');
    playerInput.value = '';
    playerInput.focus();
  }

  function hideInput() {
    inputArea.classList.add('hidden');
  }

  sendBtn.addEventListener('click', () => {
    const text = playerInput.value;
    playerInput.value = '';
    handlePlayerMessage(text);
  });

  playerInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const text = playerInput.value;
      playerInput.value = '';
      handlePlayerMessage(text);
    }
  });

  // ===========================
  // PART 7/10 – MONEY, REPUTATION & DAY END
  // ===========================

  function applySaleSuccess(product) {
    if (game.phase === PHASE.EMPLOYEE) {
      const grossYourShare = product.price * 0.40;
      const tax = grossYourShare * 0.35;
      const net = grossYourShare - tax;
      game.money += net;
    } else {
      const gross = product.sellPrice || product.price;
      const tax = gross * 0.45;
      const net = gross - tax;
      game.money += net;

      const invItem = game.inventory.find(p => p.id === product.id);
      if (invItem) invItem.stock = Math.max(0, invItem.stock - 1);
    }

    const repGain = product.repGain || (3 + product.difficulty * 2);
    game.reputation += repGain;

    checkReputationAndMoneyForUpgrade();
  }

  function applySaleFailure(product) {
    const repLoss = product.repLoss || (2 + product.difficulty * 2);
    game.reputation -= repLoss;

    if (game.phase === PHASE.EMPLOYEE && game.reputation < 0) {
      game.state = GAME_STATE.GAME_OVER;
      game.gameOverReason = 'You were fired. Reputation dropped below 0.';
    }

    if (game.phase === PHASE.OWNER && game.reputation <= 0) {
      goBankruptToEmployee();
    }
  }

  function checkReputationAndMoneyForUpgrade() {
    if (game.phase === PHASE.EMPLOYEE) {
      if (game.reputation > 100 || game.money >= 5000) {
        game.money = 1000;
        game.phase = PHASE.OWNER;
        game.state = GAME_STATE.OWNER_DAY;
        game.currentTime = cloneTime(WORKDAY_OWNER_START);
        game.hasHadLunchToday = false;
        game.warnings = [];
        generateShopIfEmpty();
      }
    }
  }

  function endOfDay() {
    if (game.phase === PHASE.EMPLOYEE) {
      game.money -= 20; // rent
      game.money -= 20; // food
      game.money -= 5;  // utilities
    }

    if (game.phase === PHASE.OWNER) {
      let totalEmployeeCost = 0;
      for (const e of game.employees) {
        totalEmployeeCost += e.dailyCost;
      }

      if (game.money >= totalEmployeeCost) {
        game.money -= totalEmployeeCost;
      } else {
        game.warnings.push(game.dayNumber);
        if (countRecentWarnings(7) >= 3) {
          game.state = GAME_STATE.GAME_OVER;
          game.gameOverReason = 'You failed to pay bills 3 times in 7 days.';
          return;
        }
      }
    }

    game.dayNumber++;
    game.hasHadLunchToday = false;

    if (game.phase === PHASE.EMPLOYEE) {
      startNewDayEmployee();
    } else {
      startNewDayOwner();
    }
  }

  function countRecentWarnings(daysWindow) {
    const currentDay = game.dayNumber;
    return game.warnings.filter(d => currentDay - d < daysWindow).length;
  }

  function startNewDayEmployee() {
    game.currentTime = cloneTime(WORKDAY_EMPLOYEE_START);
    game.state = GAME_STATE.EMPLOYEE_DAY;
  }

  function startNewDayOwner() {
    game.currentTime = cloneTime(WORKDAY_OWNER_START);
    game.state = GAME_STATE.OWNER_DAY;
  }

  function goBankruptToEmployee() {
    game.money = 0;
    game.phase = PHASE.EMPLOYEE;
    game.state = GAME_STATE.EMPLOYEE_DAY;
    game.currentTime = cloneTime(WORKDAY_EMPLOYEE_START);
    game.dayNumber++;
    game.reputation = 50;
    game.hasHadLunchToday = false;
    game.warnings = [];
    game.inventory = [];
    game.employees = [];
    game.availableProducts = [];
    game.availableEmployees = [];
  }

  // ===========================
  // PART 8/10 – SHOP: RESTOCK & EMPLOYEES
  // ===========================

  function generateShopIfEmpty() {
    if (game.availableProducts.length === 0) {
      game.availableProducts = [];
      for (let i = 0; i < 20; i++) {
        const basePrice = randInt(50, 800);
        const difficulty = Math.ceil(basePrice / 200);
        const sellPrice = Math.round(basePrice * randInt(120, 180) / 100);
        game.availableProducts.push({
          id: `p${nextProductId++}`,
          name: `Product #${nextProductId}`,
          buyPrice: basePrice,
          sellPrice,
          difficulty,
        });
      }
    }

    if (game.availableEmployees.length === 0) {
      game.availableEmployees = [];
      const names = ['Alex', 'Jordan', 'Sam', 'Casey', 'Taylor', 'Robin', 'Morgan'];
      for (let i = 0; i < 5; i++) {
        const skill = randInt(1, 5);
        const dailyCost = 15 + skill * 5;
        game.availableEmployees.push({
          id: `e${nextEmployeeId++}`,
          name: randChoice(names) + ' #' + nextEmployeeId,
          skill,
          dailyCost,
        });
      }
    }
  }

  function drawShop() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    ctx.fillStyle = '#eee';
    ctx.font = '18px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('SHOP', 40, 60);

    ctx.fillText('1) Restock products', 40, 100);
    ctx.fillText('2) Hire employees', 40, 130);

    drawButton(40, 160, 180, 30, 'Restock');
    addClickRegion(40, 160, 180, 30, () => {
      drawRestockScreen(true);
    });

    drawButton(40, 200, 180, 30, 'Hire employee');
    addClickRegion(40, 200, 180, 30, () => {
      drawHireEmployeeScreen(true);
    });

    drawButton(40, canvas.height - 60, 140, 30, 'Back');
    addClickRegion(40, canvas.height - 60, 140, 30, () => {
      game.state = GAME_STATE.OWNER_DAY;
    });

    ctx.fillText('Inventory:', 260, 100);
    let y = 120;
    for (const item of game.inventory) {
      ctx.fillText(`${item.name} - Stock: ${item.stock}, Sell: $${item.sellPrice}`, 260, y);
      y += 20;
    }
    if (game.inventory.length === 0) {
      ctx.fillText('(none)', 260, y);
      y += 20;
    }

    ctx.fillText('Employees:', 260, y + 10);
    y += 30;
    for (const emp of game.employees) {
      ctx.fillText(`${emp.name} - Skill: ${emp.skill}, Daily cost: $${emp.dailyCost}`, 260, y);
      y += 20;
    }
    if (game.employees.length === 0) {
      ctx.fillText('(none)', 260, y);
    }
  }

  function drawRestockScreen() {
    game.state = GAME_STATE.SHOP;
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    ctx.fillStyle = '#eee';
    ctx.font = '18px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('RESTOCK PRODUCTS', 40, 60);
    ctx.font = '14px monospace';
    ctx.fillText('Click a product to buy 1 unit. If you do not have enough money, you cannot buy it.', 40, 80);

    let y = 110;
    for (const p of game.availableProducts) {
      const label = `${p.name} - Buy: $${p.buyPrice}, Sell: $${p.sellPrice}, Diff: ${p.difficulty}`;
      drawButton(40, y, 620, 26, label);
      const copyP = p;
      addClickRegion(40, y, 620, 26, () => {
        buyProduct(copyP);
      });
      y += 32;
      if (y > canvas.height - 120) break;
    }

    drawButton(40, canvas.height - 60, 140, 30, 'Back');
    addClickRegion(40, canvas.height - 60, 140, 30, () => {
      game.state = GAME_STATE.SHOP;
    });
  }

  function buyProduct(p) {
    if (game.money < p.buyPrice) {
      alert('Not enough money to buy this product.');
      return;
    }
    game.money -= p.buyPrice;
    let inv = game.inventory.find(i => i.id === p.id);
    if (!inv) {
      inv = {
        id: p.id,
        name: p.name,
        buyPrice: p.buyPrice,
        sellPrice: p.sellPrice,
        difficulty: p.difficulty,
        stock: 0,
      };
      game.inventory.push(inv);
    }
    inv.stock += 1;
  }

  function drawHireEmployeeScreen() {
    game.state = GAME_STATE.SHOP;
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 40, canvas.width, canvas.height - 40);

    ctx.fillStyle = '#eee';
    ctx.font = '18px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('HIRE EMPLOYEES', 40, 60);
    ctx.font = '14px monospace';
    ctx.fillText('Click an employee to hire them. Their daily cost is added to your expenses.', 40, 80);

    let y = 110;
    for (const e of game.availableEmployees) {
      const label = `${e.name} - Skill: ${e.skill}, Daily cost: $${e.dailyCost}`;
      drawButton(40, y, 500, 26, label);
      const copyE = e;
      addClickRegion(40, y, 500, 26, () => {
        hireEmployee(copyE);
      });
      y += 32;
      if (y > canvas.height - 120) break;
    }

    drawButton(40, canvas.height - 60, 140, 30, 'Back');
    addClickRegion(40, canvas.height - 60, 140, 30, () => {
      game.state = GAME_STATE.SHOP;
    });
  }

  function hireEmployee(e) {
    if (game.money < e.dailyCost) {
      alert('Not enough money to hire this employee (you should afford at least one day).');
      return;
    }
    game.employees.push({
      id: e.id,
      name: e.name,
      skill: e.skill,
      dailyCost: e.dailyCost,
    });
    game.availableEmployees = game.availableEmployees.filter(x => x.id !== e.id);
  }

  // ===========================
  // PART 9/10 – LUNCH, INPUT & GAME LOOP
  // ===========================

  let lastTimestamp = 0;
  let lunchTimer = 0;

  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    for (const region of clickRegions) {
      if (mx >= region.x && mx <= region.x + region.w &&
          my >= region.y && my <= region.y + region.h) {
        region.onClick();
        break;
      }
    }
  });

  function update(deltaMs) {
    if (game.state === GAME_STATE.INTRO || game.state === GAME_STATE.GAME_OVER) {
      return;
    }

    if (game.state !== GAME_STATE.LUNCH_BREAK) {
      game.lastMinuteMs += deltaMs;
      while (game.lastMinuteMs >= MS_PER_GAME_MINUTE) {
        game.lastMinuteMs -= MS_PER_GAME_MINUTE;
        advanceTime(game.currentTime, 1);
      }
    }

    if (game.phase === PHASE.EMPLOYEE) {
      if (!game.hasHadLunchToday &&
          game.currentTime.hour >= 12 && game.currentTime.minute === 0 &&
          game.state !== GAME_STATE.LUNCH_BREAK) {
        game.state = GAME_STATE.LUNCH_BREAK;
        game.hasHadLunchToday = true;
        lunchTimer = 0;
      }

      if (game.state === GAME_STATE.LUNCH_BREAK) {
        lunchTimer += deltaMs;
        if (lunchTimer > 3000) {
          game.state = GAME_STATE.EMPLOYEE_DAY;
        }
      }

      if (timeGreaterOrEqual(game.currentTime, WORKDAY_EMPLOYEE_END) &&
          game.state !== GAME_STATE.LUNCH_BREAK &&
          game.state !== GAME_STATE.CALL) {
        endOfDay();
      }
    }
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    clickRegions.length = 0;
    drawHUD();

    switch (game.state) {
      case GAME_STATE.INTRO:
        drawIntro();
        break;
      case GAME_STATE.EMPLOYEE_DAY:
        drawEmployeeOffice();
        break;
      case GAME_STATE.OWNER_DAY:
        drawOwnerOffice();
        break;
      case GAME_STATE.LUNCH_BREAK:
        drawLunchBreak();
        break;
      case GAME_STATE.CALL:
        drawCallScreen();
        break;
      case GAME_STATE.RULES:
        drawRules();
        break;
      case GAME_STATE.SHOP:
        drawShop();
        break;
      case GAME_STATE.GAME_OVER:
        drawGameOver();
        break;
    }
  }

  function gameLoop(timestamp) {
    if (!lastTimestamp) lastTimestamp = timestamp;
    const delta = timestamp - lastTimestamp;
    lastTimestamp = timestamp;

    update(delta);
    render();

    requestAnimationFrame(gameLoop);
  }

  // ===========================
  // PART 10/10 – RESET & START
  // ===========================

  function resetGame() {
    game.phase = PHASE.EMPLOYEE;
    game.state = GAME_STATE.INTRO;
    game.currentTime = cloneTime(WORKDAY_EMPLOYEE_START);
    game.lastMinuteMs = 0;
    game.dayNumber = 1;
    game.money = 0;
    game.reputation = 50;
    game.warnings = [];
    game.hasHadLunchToday = false;
    game.isInCall = false;
    game.callLog = [];
    game.callNPCMood = 0;
    game.callProduct = null;
    game.callStep = 0;
    game.inventory = [];
    game.availableProducts = [];
    game.availableEmployees = [];
    game.employees = [];
    game.gameOverReason = '';
    hideInput();
  }

  resetGame();
  requestAnimationFrame(gameLoop);

  </script>
</body>
</html>
