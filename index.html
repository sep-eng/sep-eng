<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    SEP + MAKE IT HAPPEN
    Single-page application with scenes, cart, and simple running challenge.
    Tech: HTML + inline CSS + vanilla JS + Tailwind via CDN + GSAP via CDN.
  -->
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>SEP · Make It Happen</title>
  <meta
    name="description"
    content="SEP minimalist clothing in Copenhagen and a simple movement challenge called Make It Happen."
  />

  <!-- Favicon (simple black square placeholder) -->
  <link
    rel="icon"
    href="https://upload.wikimedia.org/wikipedia/commons/3/3f/Black_square.jpg"
  />

  <!-- Inter font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- GSAP + ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <!-- Inline CSS for custom layout and scene system -->
  <style>
    /* Base page styling */
    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(to bottom, #000000, #ffffff);
      color: #111111;
      scroll-behavior: smooth;
      transition:
        background 0.5s ease,
        color 0.5s ease;
    }

    /* Shared transition on text elements */
    h1,
    h2,
    h3,
    h4,
    p,
    button,
    a,
    span,
    select,
    input,
    label {
      transition:
        color 0.5s ease,
        background-color 0.5s ease,
        border-color 0.5s ease;
    }

    /* Light text helper on dark backgrounds */
    .theme-text {
      color: #e6e6e6;
    }

    /* Buttons and links small hover motion */
    button,
    a {
      transition: all 0.25s ease;
    }

    button:hover,
    a:hover {
      transform: translateY(-2px);
    }

    /* Simple popup used for cart + copy actions */
    .popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #16a34a;
      color: #ffffff;
      padding: 10px 16px;
      border-radius: 9999px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 100;
      font-size: 12px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .popup.show {
      opacity: 1;
    }

    /* Sections that fade in on scroll */
    .fade-section {
      opacity: 0;
      transform: translateY(30px);
    }

    /* Scene system - only active scene is visible */
    .scene {
      display: none;
    }

    .scene.active {
      display: block;
    }

    /* Cart sidebar base styling */
    #cartSidebar {
      color: #000000;
      transition:
        background 0.5s ease,
        color 0.5s ease,
        transform 0.3s ease;
    }

    /* Helper for elements that should fade when cart is open */
    .hidden-during-cart {
      transition: opacity 0.2s ease;
    }

    /* Card used across MIH for a consistent look */
    .mih-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
    }

    /* Global navigation (hamburger + dropdown) */
    #globalNavButtons {
      position: fixed;
      top: 12px;
      right: 14px;
      z-index: 70;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .nav-toggle-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border-radius: 9999px;
      padding: 6px 10px;
      font-size: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(10px);
    }

    .nav-lines {
      display: inline-block;
      width: 14px;
      height: 10px;
      position: relative;
    }

    .nav-lines span {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: #ffffff;
      border-radius: 999px;
    }

    .nav-lines span:nth-child(1) {
      top: 0;
    }

    .nav-lines span:nth-child(2) {
      top: 4px;
    }

    .nav-lines span:nth-child(3) {
      top: 8px;
    }

    #navMenu {
      margin-top: 4px;
      background: rgba(0, 0, 0, 0.88);
      border-radius: 9999px;
      padding: 6px 8px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      display: none;
      flex-direction: column;
      gap: 4px;
      backdrop-filter: blur(12px);
    }

    #navMenu.show {
      display: flex;
    }

    #navMenu button {
      font-size: 10px;
      padding: 4px 9px;
      border-radius: 9999px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: transparent;
      color: #f3f3f3;
      white-space: nowrap;
    }

    /* Language selector row in nav */
    .nav-lang-row {
      border-top: 1px solid rgba(255, 255, 255, 0.18);
      margin-top: 4px;
      padding-top: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
      justify-content: space-between;
    }

    .nav-lang-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
    }

    .lang-btn {
      font-size: 9px;
      padding: 3px 7px;
      border-radius: 9999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: transparent;
      color: #e5e7eb;
    }

    .lang-btn-active {
      background: #ffffff;
      color: #000000;
      border-color: #ffffff;
    }

    /* Exit to Home button */
    #exitHomeWrapper {
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 60;
    }

    /* Profile labels in MIH */
    .profile-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .profile-value {
      font-size: 14px;
    }
  </style>
</head>

<body>
  <!-- GLOBAL NAVIGATION: hamburger + dropdown + language selector -->
  <div id="globalNavButtons" class="hidden-during-cart">
    <button
      id="mainNavToggle"
      class="nav-toggle-btn"
      type="button"
    >
      <span class="nav-lines">
        <span></span>
        <span></span>
        <span></span>
      </span>
      <span data-i18n="nav_menu_label">Menu</span>
    </button>

    <div id="navMenu">
      <!-- Scene links - SEP + MIH -->
      <button
        type="button"
        onclick="showScene('home')"
        data-i18n="nav_home"
      >
        Home
      </button>

      <button
        type="button"
        onclick="showScene('sep-shop')"
        data-i18n="nav_sep_shop"
      >
        SEP shop
      </button>

      <button
        type="button"
        onclick="showScene('sep-about')"
        data-i18n="nav_sep_about"
      >
        About SEP
      </button>

      <button
        type="button"
        onclick="showScene('mih-welcome')"
        data-i18n="nav_mih"
      >
        Make It Happen
      </button>

      <button
        type="button"
        onclick="showScene('mih-about')"
        data-i18n="nav_mih_about"
      >
        About Make It Happen
      </button>

      <!-- Language selector row -->
      <div class="nav-lang-row">
        <span
          class="nav-lang-label"
          data-i18n="nav_language_label"
        >
          Language
        </span>
        <div class="flex gap-1">
          <button
            type="button"
            class="lang-btn"
            data-lang="en"
          >
            EN
          </button>
          <button
            type="button"
            class="lang-btn"
            data-lang="da"
          >
            DA
          </button>
          <button
            type="button"
            class="lang-btn"
            data-lang="cs"
          >
            CS
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- EXIT TO HOME BUTTON (hidden on home scene) -->
  <div id="exitHomeWrapper" class="hidden">
    <button
      class="px-3 py-1 rounded-full bg-black/80 text-white text-[11px] border border-white/30 backdrop-blur hover:bg-black transition"
      onclick="showScene('home')"
      data-i18n="btn_back_home"
    >
      ← Home
    </button>
  </div>

  <!-- ===================== SCENE: HOME / START ===================== -->
  <section id="scene-home" class="scene active">
    <div class="min-h-screen flex items-center justify-center bg-black text-white px-6">
      <div class="max-w-xl w-full text-center space-y-8 fade-section">
        <div>
          <p class="tracking-[0.3em] text-xs text-gray-400 uppercase mb-2">
            SEP · Make It Happen
          </p>
          <h1
            class="text-3xl md:text-4xl font-semibold mb-3"
            data-i18n="home_title"
          >
            One page. Two projects.
          </h1>
          <p
            class="text-sm md:text-base text-gray-300"
            data-i18n="home_subtitle"
          >
            Choose where you want to start. You can always come back here.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm md:text-base">
          <!-- Go to SEP shop -->
          <button
            class="w-full px-6 py-4 rounded-2xl bg-white text-black shadow-lg hover:-translate-y-0.5 hover:shadow-xl transition"
            onclick="showScene('sep-shop')"
          >
            <div
              class="font-semibold mb-1"
              data-i18n="home_sep_cta_title"
            >
              Go to SEP shop
            </div>
            <div
              class="text-xs text-gray-700"
              data-i18n="home_sep_cta_body"
            >
              Minimalist clothing. Hand pressed in Copenhagen.
            </div>
          </button>

          <!-- Go to Make It Happen -->
          <button
            class="w-full px-6 py-4 rounded-2xl bg-black border border-white/15 text-white hover:-translate-y-0.5 hover:border-white/40 transition"
            onclick="showScene('mih-welcome')"
          >
            <div
              class="font-semibold mb-1"
              data-i18n="home_mih_cta_title"
            >
              Go to Make It Happen
            </div>
            <div
              class="text-xs text-gray-300"
              data-i18n="home_mih_cta_body"
            >
              Log your runs. Climb your league. No apps. No fees.
            </div>
          </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-300">
          <!-- About SEP -->
          <button
            class="w-full px-5 py-3 rounded-full border border-white/25 hover:border-white/60 transition"
            onclick="showScene('sep-about')"
            data-i18n="home_about_sep"
          >
            Learn more about SEP
          </button>

          <!-- About MIH -->
          <button
            class="w-full px-5 py-3 rounded-full border border-white/25 hover:border-white/60 transition"
            onclick="showScene('mih-about')"
            data-i18n="home_about_mih"
          >
            Learn more about Make It Happen
          </button>
        </div>
      </div>
    </div>
  </section>
  <!-- ===================== END SCENE: HOME / START ===================== -->

  <!-- ===================== SCENE: SEP SHOP ===================== -->
  <section id="scene-sep-shop" class="scene">
    <!-- Hero -->
    <header class="py-20 text-center fade-section">
      <h1
        class="theme-text text-5xl font-bold mb-4"
        data-i18n="sep_hero_title"
      >
        Minimalist clothing made with intention.
      </h1>
      <p
        class="theme-text text-lg mb-8"
        data-i18n="sep_hero_subtitle"
      >
        Soft, clean and hand pressed in Copenhagen.
      </p>

      <div
        id="sepHeroButtons"
        class="flex justify-center gap-4 hidden-during-cart"
      >
        <a
          href="#sep-products"
          class="bg-white text-black px-6 py-3 rounded-full font-medium"
          data-i18n="sep_hero_shop_now"
        >
          Shop Now
        </a>

        <button
          id="viewCartBtn"
          class="border border-white text-white px-6 py-3 rounded-full font-medium relative"
          type="button"
          data-i18n="sep_hero_view_cart"
        >
          View Cart
          <span
            id="cartCounter"
            class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hidden"
          >
            0
          </span>
        </button>
      </div>
    </header>

    <!-- SEP Products -->
    <section
      id="sep-products"
      class="py-20 px-6 fade-section"
    >
      <div class="text-center mb-12">
        <h2
          class="theme-text text-4xl font-bold mb-4"
          data-i18n="sep_products_heading"
        >
          Three products. One choice.
        </h2>
        <p
          class="theme-text"
          data-i18n="sep_products_subheading"
        >
          Soft, durable and timeless.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
        <!-- Product: White T-shirt -->
        <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
          <div class="w-full h-64 rounded mb-4 bg-gradient-to-br from-white via-neutral-200 to-neutral-400 flex items-center justify-center text-xs text-neutral-600">
            <span data-i18n="sep_product_tshirt_image_alt">
              White T-shirt placeholder
            </span>
          </div>
          <h3
            class="text-xl font-bold mb-2"
            data-i18n="sep_product_tshirt_name"
          >
            SEP White T-shirt
          </h3>
          <p
            class="mb-2"
            data-i18n="sep_product_price_180"
          >
            180 kr.
          </p>

          <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
            <option>XS</option>
            <option>S</option>
            <option>M</option>
            <option>L</option>
            <option>XL</option>
          </select>

          <div class="flex justify-center gap-2">
            <input
              type="number"
              min="1"
              value="1"
              class="theme-text border rounded w-16 text-center bg-transparent quantity-selector"
            />
            <button
              class="add-to-cart bg-white text-black px-4 py-2 rounded"
              type="button"
              data-product-key="tshirt"
              data-i18n="sep_product_add"
            >
              Add
            </button>
          </div>
        </div>

        <!-- Product: Black Hoodie -->
        <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
          <div class="w-full h-64 rounded mb-4 bg-gradient-to-br from-neutral-900 via-neutral-700 to-neutral-500 flex items-center justify-center text-xs text-neutral-200">
            <span data-i18n="sep_product_hoodie_image_alt">
              Black hoodie placeholder
            </span>
          </div>
          <h3
            class="text-xl font-bold mb-2"
            data-i18n="sep_product_hoodie_name"
          >
            SEP Black Hoodie
          </h3>
          <p
            class="mb-2"
            data-i18n="sep_product_price_180"
          >
            180 kr.
          </p>

          <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
            <option>XS</option>
            <option>S</option>
            <option>M</option>
            <option>L</option>
            <option>XL</option>
          </select>

          <div class="flex justify-center gap-2">
            <input
              type="number"
              min="1"
              value="1"
              class="theme-text border rounded w-16 text-center bg-transparent quantity-selector"
            />
            <button
              class="add-to-cart bg-white text-black px-4 py-2 rounded"
              type="button"
              data-product-key="hoodie"
              data-i18n="sep_product_add"
            >
              Add
            </button>
          </div>
        </div>

        <!-- Product: Black Trousers -->
        <div class="product-card bg-white/10 p-6 rounded-xl shadow-md text-center backdrop-blur">
          <div class="w-full h-64 rounded mb-4 bg-gradient-to-br from-neutral-900 via-neutral-700 to-neutral-500 flex items-center justify-center text-xs text-neutral-200">
            <span data-i18n="sep_product_trousers_image_alt">
              Black trousers placeholder
            </span>
          </div>
          <h3
            class="text-xl font-bold mb-2"
            data-i18n="sep_product_trousers_name"
          >
            SEP Black Trousers
          </h3>
          <p
            class="mb-2"
            data-i18n="sep_product_price_180"
          >
            180 kr.
          </p>

          <select class="theme-text border rounded px-3 py-2 mb-2 bg-transparent">
            <option>XS</option>
            <option>S</option>
            <option>M</option>
            <option>L</option>
            <option>XL</option>
          </select>

          <div class="flex justify-center gap-2">
            <input
              type="number"
              min="1"
              value="1"
              class="theme-text border rounded w-16 text-center bg-transparent quantity-selector"
            />
            <button
              class="add-to-cart bg-white text-black px-4 py-2 rounded"
              type="button"
              data-product-key="trousers"
              data-i18n="sep_product_add"
            >
              Add
            </button>
          </div>
        </div>
      </div>
    </section>
        <!-- Cart Sidebar -->
    <div
      id="cartSidebar"
      class="fixed top-0 right-0 h-full w-80 bg-white shadow-xl translate-x-full z-50 overflow-y-auto"
    >
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3
            class="text-xl font-bold"
            data-i18n="cart_title"
          >
            Your Cart
          </h3>
          <button
            id="closeCart"
            type="button"
          >
            ✕
          </button>
        </div>

        <!-- Shipping choice -->
        <div class="mb-4 text-sm">
          <p
            class="mb-1 font-medium"
            data-i18n="cart_shipping_title"
          >
            Shipping destination
          </p>
          <div class="flex gap-2 text-xs">
            <button
              id="shippingCph"
              class="px-3 py-1 rounded-full border border-gray-400 bg-gray-200"
              type="button"
              data-i18n="cart_shipping_cph"
            >
              Copenhagen
            </button>
            <button
              id="shippingNonCph"
              class="px-3 py-1 rounded-full border border-gray-400 bg-transparent"
              type="button"
              data-i18n="cart_shipping_rest"
            >
              Rest of Denmark
            </button>
          </div>
          <p
            class="mt-1 text-gray-500 text-xs"
            data-i18n="cart_shipping_hint"
          >
            Copenhagen is free. Rest of Denmark adds +45 kr.
          </p>
        </div>

        <div
          id="cartItems"
          class="space-y-4 text-sm"
        ></div>

        <div class="border-t border-gray-300 pt-4 mt-4 text-sm">
          <div class="flex justify-between mb-1">
            <span data-i18n="cart_subtotal_label">Subtotal:</span>
            <span
              id="cartSubtotal"
              class="font-bold"
            >
              0 kr.
            </span>
          </div>

          <div class="flex justify-between mb-2 text-xs text-gray-600">
            <span data-i18n="cart_shipping_label">Shipping:</span>
            <span id="cartShippingLabel">+45 kr.</span>
          </div>

          <div class="flex justify-between font-semibold border-t border-gray-300 pt-2 mb-3">
            <span data-i18n="cart_total_label">Total:</span>
            <span id="cartTotal">45 kr.</span>
          </div>

          <button
            id="openMobilePay"
            class="w-full bg-green-500 text-white py-2 rounded mb-2"
            type="button"
            data-i18n="cart_mobilepay_open"
          >
            Open MobilePay
          </button>

          <p
            class="text-xs text-gray-500 mb-2 text-center"
            data-i18n="cart_mobilepay_hint"
          >
            “Open MobilePay” only works as a real link on mobile.
          </p>

          <button
            id="copyMobilePay"
            class="w-full bg-gray-200 py-2 rounded"
            type="button"
            data-i18n="cart_copy_message"
          >
            Copy Order Message
          </button>
        </div>
      </div>
    </div>

    <!-- Cart overlay -->
    <div
      id="cartOverlay"
      class="fixed inset-0 bg-black/50 hidden z-40"
    ></div>

    <!-- How to order -->
    <section class="py-20 text-center fade-section">
      <h2
        class="text-3xl font-bold mb-10"
        data-i18n="how_title"
      >
        How to order
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-5 gap-6 max-w-6xl mx-auto text-sm md:text-base">
        <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
          <h3
            class="font-bold text-lg mb-2"
            data-i18n="how_step1_title"
          >
            1. Choose
          </h3>
          <p data-i18n="how_step1_body">
            Pick your SEP piece, select a size and choose how many you want.
          </p>
        </div>

        <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
          <h3
            class="font-bold text-lg mb-2"
            data-i18n="how_step2_title"
          >
            2. Add to cart
          </h3>
          <p data-i18n="how_step2_body">
            Press “Add” on each product card. Then use “View Cart” to review your order.
          </p>
        </div>

        <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
          <h3
            class="font-bold text-lg mb-2"
            data-i18n="how_step3_title"
          >
            3. Copy order message
          </h3>
          <p data-i18n="how_step3_body">
            Inside the cart, press “Copy Order Message”. It includes all items, shipping and total.
          </p>
        </div>

        <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
          <h3
            class="font-bold text-lg mb-2"
            data-i18n="how_step4_title"
          >
            4. Pay with MobilePay
          </h3>
          <p data-i18n="how_step4_body">
            Send the total amount to <b>5894BZ</b> in MobilePay. Copenhagen is free. The rest of Denmark adds +45 kr.
          </p>
        </div>

        <div class="bg-white/10 rounded-xl p-6 backdrop-blur">
          <h3
            class="font-bold text-lg mb-2"
            data-i18n="how_step5_title"
          >
            5. Send us your order
          </h3>
          <p data-i18n="how_step5_body">
            Paste your copied message into a DM to <b>@seproairesis</b> on Instagram or TikTok. We currently deliver in Denmark only.
          </p>
        </div>
      </div>
    </section>

    <!-- SEP Footer -->
    <footer class="text-center py-10 fade-section text-sm">
      <p data-i18n="footer_main">
        © 2025 SEP – Se Proairesis (ancient Greek for “Your Choice”) · MobilePay 5894BZ · +45 kr shipping (FREE in Copenhagen) · Delivery in Denmark only.
      </p>

      <p
        class="mt-2 text-xs text-gray-400"
        data-i18n="footer_privacy"
      >
        No data selling. No ads that follow you. No creepy tracking. Just simple, intentional clothing.
      </p>

      <div class="flex justify-center gap-4 mt-4">
        <a
          href="https://instagram.com/seproairesis"
          class="bg-gradient-to-br from-pink-500 to-purple-600 text-white px-4 py-2 rounded-full text-xs"
          target="_blank"
          rel="noreferrer"
          data-i18n="footer_instagram"
        >
          Instagram @seproairesis
        </a>

        <a
          href="https://tiktok.com/@seproairesis"
          class="bg-black text-white px-4 py-2 rounded-full text-xs"
          target="_blank"
          rel="noreferrer"
          data-i18n="footer_tiktok"
        >
          TikTok @seproairesis
        </a>
      </div>
    </footer>
  </section>
  <!-- ===================== END SCENE: SEP SHOP ===================== -->

  <!-- ===================== SCENE: ABOUT SEP ===================== -->
  <section id="scene-sep-about" class="scene">
    <div class="min-h-screen bg-black text-white flex items-center justify-center px-6 py-16">
      <div class="max-w-3xl mx-auto space-y-6 text-sm md:text-base fade-section">
        <h2
          class="text-3xl font-bold tracking-wide"
          data-i18n="about_sep_title"
        >
          About SEP
        </h2>

        <p
          class="text-gray-300"
          data-i18n="about_sep_p1"
        >
          SEP stands for <span class="italic">Se Proairesis</span>. It is an ancient Greek phrase that roughly means “Your Choice”.
          The brand is built around that idea: you choose how simple, intentional and calm your wardrobe can be.
        </p>

        <p
          class="text-gray-300"
          data-i18n="about_sep_p2"
        >
          The clothes are minimalist on purpose. A white T-shirt, a black hoodie and black trousers that feel good to wear
          and work with almost anything. Everything is hand pressed in Copenhagen in small batches.
        </p>

        <p
          class="text-gray-300"
          data-i18n="about_sep_p3"
        >
          There are no big collections and no constant drops. You pick your size and quantity, copy your order message,
          send it and that is it. Simple on purpose.
        </p>

        <p
          class="text-gray-400 text-xs"
          data-i18n="about_sep_p4"
        >
          There are also no hidden tricks behind SEP. No data selling. No tracking across the internet. No dark patterns.
          Just a straightforward site that helps you get the pieces you want.
        </p>

        <div class="flex flex-wrap gap-3 text-xs md:text-sm mt-4">
          <button
            class="px-4 py-2 rounded-full border border-white/20"
            onclick="showScene('sep-shop')"
            data-i18n="about_sep_back_shop"
          >
            Back to SEP shop
          </button>

          <button
            class="px-4 py-2 rounded-full border border-white/20"
            onclick="showScene('mih-welcome')"
            data-i18n="about_sep_go_mih"
          >
            Go to Make It Happen
          </button>
        </div>
      </div>
    </div>
  </section>
  <!-- ===================== END SCENE: ABOUT SEP ===================== -->

  <!-- ===================== SCENE: MIH WELCOME ===================== -->
  <section id="scene-mih-welcome" class="scene">
    <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
      <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">
            MAKE IT
          </div>
          <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">
            SEP
          </div>
          <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">
            HAPPEN
          </div>
        </div>

        <div class="flex flex-wrap gap-2 text-xs md:text-sm">
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-login')"
          >
            Login
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-welcome')"
          >
            Welcome
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-leaderboard')"
          >
            Leaderboard
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-stats')"
          >
            Stats
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-about')"
          >
            About
          </button>
        </div>

        <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
          <button
            type="button"
            class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
            onclick="showScene('sep-shop')"
          >
            Back to SEP
          </button>
        </div>
      </div>

      <main class="max-w-5xl mx-auto">
        <div class="mih-card p-6 md:p-8 space-y-4 text-sm md:text-base">
          <div>
            <h1 class="text-2xl md:text-3xl font-semibold mb-2">
              Move more. Compete. Make it happen.
            </h1>
            <p class="text-gray-300">
              Run, walk or cycle, log your distance and slowly climb the leaderboard in your own league.
            </p>
          </div>

          <div class="flex flex-wrap gap-3 text-xs md:text-sm">
            <button
              class="px-5 py-2 rounded-full bg-white text-black"
              onclick="showScene('mih-leaderboard')"
            >
              See leaderboard →
            </button>
            <button
              class="px-5 py-2 rounded-full border border-white/20 text-gray-200"
              onclick="showScene('mih-about')"
            >
              What is this?
            </button>
          </div>

          <div class="flex flex-wrap gap-2 text-[11px] text-gray-300 mt-2">
            <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">
              4 leagues: Amateurs, Intermediates, Pros, Legends
            </span>
            <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">
              New people are placed where leagues are lightest
            </span>
            <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5">
              Ranking rewards distance, commitment and improvement
            </span>
          </div>
        </div>
      </main>
    </div>
  </section>
  <!-- ===================== END SCENE: MIH WELCOME ===================== -->

  <!-- ===================== SCENE: MIH LOGIN ===================== -->
  <section id="scene-mih-login" class="scene">
    <div class="min-h-screen bg-black text-white pt-16 pb-20 px-4 md:px-6">
      <div class="max-w-5xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mb-1">
            MAKE IT
          </div>
          <div class="text-2xl md:text-3xl font-semibold tracking-[0.5em] uppercase">
            SEP
          </div>
          <div class="text-[10px] tracking-[0.5em] uppercase text-gray-400 mt-1">
            HAPPEN
          </div>
        </div>

        <div class="flex flex-wrap gap-2 text-xs md:text-sm">
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-login')"
          >
            Login
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-welcome')"
          >
            Welcome
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-leaderboard')"
          >
            Leaderboard
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-stats')"
          >
            Stats
          </button>
          <button
            class="px-3 py-1 rounded-full border border-white/20 text-gray-300"
            onclick="showScene('mih-about')"
          >
            About
          </button>
        </div>

        <div class="flex flex-col items-end gap-2 text-[11px] text-gray-400 min-w-[160px]">
          <button
            type="button"
            class="px-3 py-1 rounded-full border border-white/25 text-[11px] text-gray-200"
            onclick="showScene('sep-shop')"
          >
            Back to SEP
          </button>
        </div>
      </div>

      <main class="max-w-5xl mx-auto">
        <div class="mih-card p-6 md:p-8 text-sm md:text-base">
          <h1 class="text-2xl md:text-3xl font-semibold mb-2">
            Log in to Make It Happen
          </h1>
          <p class="text-gray-300 mb-4">
            Create a simple account so the site knows who you are and only you can manage your activities.
          </p>

          <form
            id="login-form"
            class="space-y-3 mt-2"
          >
            <div>
              <label
                for="login-name"
                class="block text-xs text-gray-400 mb-1"
              >
                Name
              </label>
              <input
                id="login-name"
                type="text"
                placeholder="e.g. Daniel"
                class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm"
                required
              />
            </div>

            <div>
              <label
                for="login-password"
                class="block text-xs text-gray-400 mb-1"
              >
                Password
              </label>
              <input
                id="login-password"
                type="password"
                placeholder="Choose something simple"
                class="w-full px-3 py-2 rounded-full bg-black/40 border border-white/15 text-sm"
                required
              />
            </div>

            <button
              type="submit"
              class="px-5 py-2 rounded-full bg-white text-black text-xs md:text-sm mt-1"
            >
              Log in / Create account
            </button>

            <p class="text-[11px] text-gray-400 mt-2">
              If this is your first time with this name, we will create a new account and place you into a league.
            </p>
          </form>

          <p class="text-[11px] text-gray-500 mt-4">
            Your login is saved in this browser. Accounts that stay logged out for more than 30 days are deleted together with their activities.
          </p>
        </div>
      </main>
    </div>
  </section>
  <!-- ===================== END SCENE: MIH LOGIN ===================== -->
  <!-- ============================= -->
  <!-- PART 3 - SCRIPT (TOP HALF)   -->
  <!-- ============================= -->

  <script>
    // ============================================
    // TRANSLATION SYSTEM - SEP ONLY
    // ============================================

    // Current language code.
    // Supported:
    //  - "en"  English
    //  - "da"  Danish (Dansk)
    //  - "cs"  Czech (Česky)
    let currentLang = "en";

    // Translations object.
    // Keys are language codes. Values are dictionaries of label keys.
    // These keys are used mainly for SEP UI text and JS popups.
    const translations = {
      en: {
        // Global nav
        nav_sep_shop: "SEP shop",
        nav_sep_about: "About SEP",
        nav_mih: "Make It Happen",
        nav_mih_about: "About Make It Happen",
        nav_language: "Language",

        // Hero text
        hero_title: "Minimalist clothing made with intention.",
        hero_subtitle: "Soft, clean and hand pressed in Copenhagen.",
        hero_shop_now: "Shop now",
        hero_view_cart: "View cart",

        // Product section
        products_title: "Three products. One choice.",
        products_subtitle: "Soft, durable and calm to wear.",

        // Cart
        cart_title: "Your cart",
        cart_shipping_destination: "Shipping destination",
        cart_shipping_cph: "Copenhagen",
        cart_shipping_rest: "Rest of Denmark",
        cart_shipping_hint: "Copenhagen = free shipping. Rest of Denmark = +45 kr.",
        cart_subtotal: "Subtotal",
        cart_shipping: "Shipping",
        cart_total: "Total",
        cart_mobilepay_button: "Open MobilePay",
        cart_mobilepay_hint: "“Open MobilePay” only works on mobile devices.",
        cart_copy_button: "Copy order message",
        cart_empty: "Cart is empty.",
        cart_size_label: "Size",
        cart_quantity_label: "Qty",
        cart_remove_label: "Remove",

        // Shipping labels
        shipping_free_cph: "0 kr. (FREE in Copenhagen)",
        shipping_rest_label: "+45 kr.",

        // Popup texts
        popup_added: "Added to cart",
        popup_order_copied: "Order message copied!",

        // How to order
        order_title: "How to order",
        order_step1_title: "1. Choose",
        order_step1_body: "Select your favourite SEP piece, then pick your size and quantity.",
        order_step2_title: "2. Add to cart",
        order_step2_body: "Press “Add” under each product. When you are ready, open your cart.",
        order_step3_title: "3. Copy order message",
        order_step3_body: "Inside your cart, press “Copy order message” to copy everything.",
        order_step4_title: "4. Pay with MobilePay",
        order_step4_body: "Send the total amount to 5894BZ with MobilePay.",
        order_step5_title: "5. Send us your order",
        order_step5_body: "Send the copied message to @seproairesis on Instagram or TikTok.",

        // Footer
        footer_main:
          "© 2025 SEP – Se Proairesis (ancient Greek for “Your Choice”) • MobilePay 5894BZ • +45 kr shipping (FREE in Copenhagen) • Delivered only within Denmark.",
        footer_privacy:
          "No data selling. No ads following you around. No creepy tracking. Just simple, intentional clothing.",

        // About SEP
        about_sep_title: "About SEP",
        about_sep_p1:
          "SEP stands for Se Proairesis. It is an ancient Greek phrase that roughly means “Your Choice”. The brand is built around that idea: you choose how simple, intentional and calm your wardrobe can be.",
        about_sep_p2:
          "The clothes are minimalist on purpose. A white T shirt, a black hoodie and black trousers that feel good to wear and work with almost anything. Everything is hand pressed in Copenhagen in small batches.",
        about_sep_p3:
          "There are no big collections and no constant drops. You pick your size and quantity, copy your order message, send it, and that is it.",
        about_sep_p4:
          "There are also no hidden tricks behind SEP. No data selling. No tracking across the internet. No dark patterns trying to keep you here for hours.",
        about_sep_back_to_shop: "Back to SEP shop",
        about_sep_go_to_mih: "Go to Make It Happen",

        // Order message labels used in clipboard content
        order_greeting: "Hi SEP, here is my order:",
        order_label_items: "Items",
        order_label_subtotal: "Subtotal",
        order_label_shipping: "Shipping",
        order_label_total: "Total",

        // Misc
        home_button_label: "Home"
      },

      da: {
        // Global nav
        nav_sep_shop: "SEP butik",
        nav_sep_about: "Om SEP",
        nav_mih: "Make It Happen",
        nav_mih_about: "Om Make It Happen",
        nav_language: "Sprog",

        // Hero
        hero_title: "Minimalistisk tøj med omtanke.",
        hero_subtitle: "Blødt, rent og håndpresset i København.",
        hero_shop_now: "Gå til butik",
        hero_view_cart: "Se kurv",

        // Product section
        products_title: "Tre produkter. Ét valg.",
        products_subtitle: "Blødt, holdbart og roligt at have på.",

        // Cart
        cart_title: "Din kurv",
        cart_shipping_destination: "Leveringssted",
        cart_shipping_cph: "København",
        cart_shipping_rest: "Resten af Danmark",
        cart_shipping_hint: "København = gratis levering. Resten af Danmark = +45 kr.",
        cart_subtotal: "Subtotal",
        cart_shipping: "Fragt",
        cart_total: "I alt",
        cart_mobilepay_button: "Åbn MobilePay",
        cart_mobilepay_hint: "“Åbn MobilePay” virker kun på mobilenheder.",
        cart_copy_button: "Kopiér ordrebesked",
        cart_empty: "Kurven er tom.",
        cart_size_label: "Størrelse",
        cart_quantity_label: "Antal",
        cart_remove_label: "Fjern",

        // Shipping labels
        shipping_free_cph: "0 kr. (GRATIS i København)",
        shipping_rest_label: "+45 kr.",

        // Popups
        popup_added: "Lagt i kurv",
        popup_order_copied: "Ordrebesked kopieret!",

        // How to order
        order_title: "Sådan bestiller du",
        order_step1_title: "1. Vælg",
        order_step1_body: "Vælg dit yndlings SEP produkt, størrelse og antal.",
        order_step2_title: "2. Læg i kurv",
        order_step2_body: "Tryk “Læg i kurv”. Når du er klar, åbner du kurven.",
        order_step3_title: "3. Kopiér ordrebesked",
        order_step3_body: "I kurven trykker du “Kopiér ordrebesked” for at kopiere alt.",
        order_step4_title: "4. Betal med MobilePay",
        order_step4_body: "Send det samlede beløb til 5894BZ via MobilePay.",
        order_step5_title: "5. Send din ordre",
        order_step5_body: "Send den kopierede besked til @seproairesis på Instagram eller TikTok.",

        // Footer
        footer_main:
          "© 2025 SEP – Se Proairesis (oldgræsk for “Dit valg”) • MobilePay 5894BZ • +45 kr fragt (GRATIS i København) • Levering kun i Danmark.",
        footer_privacy:
          "Ingen datasalg. Ingen annoncer der følger dig. Ingen creepy tracking. Bare enkelt, gennemtænkt tøj.",

        // About SEP
        about_sep_title: "Om SEP",
        about_sep_p1:
          "SEP står for Se Proairesis. Det er et oldgræsk udtryk, som betyder noget i retning af “Dit valg”. Mærket er bygget på den idé: du vælger hvor enkelt og roligt dit tøj skal være.",
        about_sep_p2:
          "Tøjet er minimalistisk med vilje. En hvid T shirt, en sort hoodie og sorte bukser, der føles godt at have på og passer til næsten alt. Alt håndpresses i København i små batches.",
        about_sep_p3:
          "Der er ingen store kollektioner og ingen konstante drops. Du vælger størrelse og antal, kopierer din ordrebesked, sender den, og det er det.",
        about_sep_p4:
          "Der er heller ingen skjulte tricks bag SEP. Intet datasalg. Ingen sporing på tværs af internettet. Ingen mørke designmønstre, der prøver at holde dig her.",
        about_sep_back_to_shop: "Tilbage til SEP butik",
        about_sep_go_to_mih: "Gå til Make It Happen",

        // Order message labels
        order_greeting: "Hej SEP, her er min ordre:",
        order_label_items: "Produkter",
        order_label_subtotal: "Subtotal",
        order_label_shipping: "Fragt",
        order_label_total: "I alt",

        // Misc
        home_button_label: "Hjem"
      },

      cs: {
        // Global nav
        nav_sep_shop: "SEP obchod",
        nav_sep_about: "O značce SEP",
        nav_mih: "Make It Happen",
        nav_mih_about: "O Make It Happen",
        nav_language: "Jazyk",

        // Hero
        hero_title: "Minimalistické oblečení s jasným záměrem.",
        hero_subtitle: "Měkké, čisté a ručně lisované v Kodani.",
        hero_shop_now: "Do obchodu",
        hero_view_cart: "Zobrazit košík",

        // Product section
        products_title: "Tři produkty. Jedna volba.",
        products_subtitle: "Měkké, odolné a klidné na nošení.",

        // Cart
        cart_title: "Váš košík",
        cart_shipping_destination: "Místo doručení",
        cart_shipping_cph: "Kodaň",
        cart_shipping_rest: "Zbytek Dánska",
        cart_shipping_hint: "Kodaň = doprava zdarma. Zbytek Dánska = +45 kr.",
        cart_subtotal: "Mezisoučet",
        cart_shipping: "Doprava",
        cart_total: "Celkem",
        cart_mobilepay_button: "Otevřít MobilePay",
        cart_mobilepay_hint: "„Otevřít MobilePay“ funguje jen na mobilních zařízeních.",
        cart_copy_button: "Kopírovat objednávku",
        cart_empty: "Košík je prázdný.",
        cart_size_label: "Velikost",
        cart_quantity_label: "Počet",
        cart_remove_label: "Odstranit",

        // Shipping labels
        shipping_free_cph: "0 kr. (ZDARMA v Kodani)",
        shipping_rest_label: "+45 kr.",

        // Popups
        popup_added: "Přidáno do košíku",
        popup_order_copied: "Objednávka zkopírována!",

        // How to order
        order_title: "Jak objednat",
        order_step1_title: "1. Vyberte",
        order_step1_body: "Vyberte si oblíbený kousek SEP, velikost a počet.",
        order_step2_title: "2. Přidejte do košíku",
        order_step2_body: "Stiskněte „Přidat do košíku“. Až budete připraveni, otevřete košík.",
        order_step3_title: "3. Zkopírujte objednávku",
        order_step3_body: "V košíku stiskněte „Kopírovat objednávku“, aby se vše zkopírovalo.",
        order_step4_title: "4. Zaplaťte přes MobilePay",
        order_step4_body: "Pošlete celkovou částku na 5894BZ přes MobilePay.",
        order_step5_title: "5. Pošlete nám objednávku",
        order_step5_body: "Pošlete zkopírovanou zprávu na @seproairesis na Instagramu nebo TikToku.",

        // Footer
        footer_main:
          "© 2025 SEP – Se Proairesis (starořečtina pro „Tvoje volba“) • MobilePay 5894BZ • +45 kr doprava (ZDARMA v Kodani) • Doručení pouze v Dánsku.",
        footer_privacy:
          "Žádný prodej dat. Žádné reklamy, které vás sledují. Žádné creepy sledování. Jen jednoduché, záměrné oblečení.",

        // About SEP
        about_sep_title: "O značce SEP",
        about_sep_p1:
          "SEP znamená Se Proairesis. Je to starořecký výraz, který zhruba znamená „Tvoje volba“. Značka stojí na myšlence, že si sami volíte, jak jednoduchý a klidný váš šatník bude.",
        about_sep_p2:
          "Oblečení je záměrně minimalistické. Bílá trička, černé mikiny a černé kalhoty, které se dobře nosí a hodí se téměř ke všemu. Vše se ručně lisuje v Kodani v malých sériích.",
        about_sep_p3:
          "Nejsou tu žádné obří kolekce ani neustálé dropy. Vyberete si velikost a počet, zkopírujete objednávku, odešlete a hotovo.",
        about_sep_p4:
          "Za SEP nejsou žádné skryté triky. Žádný prodej dat. Žádné sledování napříč internetem. Žádné temné patterny, které by vás tu držely zbytečně.",
        about_sep_back_to_shop: "Zpět do SEP obchodu",
        about_sep_go_to_mih: "Přejít na Make It Happen",

        // Order message labels
        order_greeting: "Ahoj SEP, tady je moje objednávka:",
        order_label_items: "Položky",
        order_label_subtotal: "Mezisoučet",
        order_label_shipping: "Doprava",
        order_label_total: "Celkem",

        // Misc
        home_button_label: "Domů"
      }
    };

    /**
     * Translation helper.
     * Returns the string for the given key in the current language.
     * Falls back to English if missing.
     */
    function t(key) {
      if (
        translations[currentLang] &&
        Object.prototype.hasOwnProperty.call(translations[currentLang], key)
      ) {
        return translations[currentLang][key];
      }
      if (
        translations.en &&
        Object.prototype.hasOwnProperty.call(translations.en, key)
      ) {
        return translations.en[key];
      }
      return key;
    }

    /**
     * Apply translations to all elements with data-i18n="key".
     * This is used mainly in the SEP part of the UI.
     */
    function applyTranslations() {
      const translatable = document.querySelectorAll("[data-i18n]");
      translatable.forEach(function (el) {
        const key = el.getAttribute("data-i18n");
        if (!key) return;
        el.innerHTML = t(key);
      });
    }

    /**
     * Update active state on language switcher buttons.
     * Expects buttons with class "lang-btn" and data-lang attributes.
     */
    function updateLanguageButtons() {
      const buttons = document.querySelectorAll(".lang-btn");
      buttons.forEach(function (btn) {
        const lang = btn.getAttribute("data-lang");
        if (!lang) return;
        if (lang === currentLang) {
          btn.classList.add("bg-white");
          btn.classList.add("text-black");
          btn.classList.remove("bg-transparent");
          btn.classList.remove("text-white");
        } else {
          btn.classList.remove("bg-white");
          btn.classList.remove("text-black");
          btn.classList.add("bg-transparent");
          btn.classList.add("text-white");
        }
      });
    }

    /**
     * Set language and persist in localStorage.
     */
    function setLanguage(lang) {
      if (!translations[lang]) {
        lang = "en";
      }
      currentLang = lang;
      try {
        localStorage.setItem("sep_lang", currentLang);
      } catch (e) {
        // If storage fails we just carry on without persisting.
      }
      applyTranslations();
      updateLanguageButtons();
    }

    /**
     * Initialise language from:
     *  1. localStorage "sep_lang"
     *  2. browser navigator.language (short code)
     *  3. default "en"
     */
    function initLanguage() {
      let initial = "en";

      try {
        const stored = localStorage.getItem("sep_lang");
        if (stored && translations[stored]) {
          initial = stored;
        } else if (navigator.language) {
          const shortCode = navigator.language.slice(0, 2).toLowerCase();
          if (shortCode === "da" && translations.da) {
            initial = "da";
          } else if (shortCode === "cs" && translations.cs) {
            initial = "cs";
          }
        }
      } catch (e) {
        // If we cannot read from storage, just stick with default.
      }

      currentLang = initial;
      applyTranslations();
      updateLanguageButtons();
    }

    // ============================================
    // GLOBAL NAVIGATION (HAMBURGER + SCENES)
    // ============================================

    const navToggleBtn = document.getElementById("mainNavToggle");
    const navMenu = document.getElementById("navMenu");
    const globalNavButtons = document.getElementById("globalNavButtons");

    if (navToggleBtn && navMenu) {
      navToggleBtn.addEventListener("click", function () {
        navMenu.classList.toggle("show");
      });
    }

    // Attach click handlers to language buttons, if present.
    const langButtons = document.querySelectorAll(".lang-btn");
    langButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        const lang = btn.getAttribute("data-lang");
        if (lang) {
          setLanguage(lang);
        }
      });
    });

    /**
     * Show a scene by name.
     * Scenes are sections with class="scene" and id="scene-<name>".
     */
    function showScene(name) {
      const scenes = document.querySelectorAll(".scene");

      scenes.forEach(function (scene) {
        scene.classList.remove("active");
      });

      const target = document.getElementById("scene-" + name);
      if (target) {
        target.classList.add("active");
      }

      // Close nav menu when switching scenes.
      if (navMenu) {
        navMenu.classList.remove("show");
      }

      // Scroll to top.
      window.scrollTo({
        top: 0,
        left: 0,
        behavior: "instant"
      });
    }

    // ============================================
    // SEP CART LOGIC
    // ============================================

    // Local storage key for the SEP cart.
    const SEP_CART_KEY = "sep_cart_v1";

    // Cart state - list of { name, price, size, qty } objects.
    let cart = [];

    // Shipping configuration
    const SHIPPING_BASE = 45;
    let isCopenhagen = false;

    // Cached DOM nodes (will be filled in initCartDom()).
    let cartSidebarEl = null;
    let cartOverlayEl = null;
    let cartItemsContainer = null;
    let cartSubtotalEl = null;
    let cartTotalEl = null;
    let cartShippingLabelEl = null;
    let cartCounterEl = null;
    let sepHeroButtonsEl = null;
    let shippingCphBtn = null;
    let shippingNonCphBtn = null;
    let openMobilePayBtn = null;
    let copyMobilePayBtn = null;

    /**
     * Load cart state from localStorage.
     */
    function loadCartFromStorage() {
      try {
        const raw = localStorage.getItem(SEP_CART_KEY);
        if (!raw) {
          cart = [];
          return;
        }
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
          cart = parsed;
        } else {
          cart = [];
        }
      } catch (e) {
        cart = [];
      }
    }

    /**
     * Save cart state into localStorage.
     */
    function saveCartToStorage() {
      try {
        localStorage.setItem(SEP_CART_KEY, JSON.stringify(cart));
      } catch (e) {
        // Storage failure is non fatal.
      }
    }

    /**
     * Get current shipping cost for the cart.
     */
    function currentShippingCost() {
      return isCopenhagen ? 0 : SHIPPING_BASE;
    }

    /**
     * Update styling of shipping buttons (Copenhagen vs Rest of Denmark).
     */
    function updateShippingButtonsAppearance() {
      if (!shippingCphBtn || !shippingNonCphBtn) return;

      if (isCopenhagen) {
        shippingCphBtn.classList.add("bg-gray-200");
        shippingCphBtn.classList.remove("bg-transparent");

        shippingNonCphBtn.classList.remove("bg-gray-200");
        shippingNonCphBtn.classList.add("bg-transparent");
      } else {
        shippingCphBtn.classList.remove("bg-gray-200");
        shippingCphBtn.classList.add("bg-transparent");

        shippingNonCphBtn.classList.add("bg-gray-200");
        shippingNonCphBtn.classList.remove("bg-transparent");
      }
    }

    /**
     * Update the small counter badge in the "View cart" button.
     */
    function updateCartCounter() {
      if (!cartCounterEl) return;

      const totalQty = cart.reduce(function (sum, item) {
        return sum + (item.qty || 0);
      }, 0);

      if (totalQty > 0) {
        cartCounterEl.textContent = String(totalQty);
        cartCounterEl.classList.remove("hidden");
      } else {
        cartCounterEl.classList.add("hidden");
      }
    }

    /**
     * Re-render cart items list, subtotal, shipping and total.
     */
    function renderCart() {
      if (!cartItemsContainer || !cartSubtotalEl || !cartTotalEl || !cartShippingLabelEl) {
        return;
      }

      // Clear area.
      cartItemsContainer.innerHTML = "";

      if (!cart.length) {
        const empty = document.createElement("p");
        empty.className = "text-center text-gray-500 py-10 text-sm";
        empty.textContent = t("cart_empty");
        cartItemsContainer.appendChild(empty);

        cartSubtotalEl.textContent = "0 kr.";
        cartShippingLabelEl.textContent = isCopenhagen
          ? t("shipping_free_cph")
          : t("shipping_rest_label");
        cartTotalEl.textContent = isCopenhagen ? "0 kr." : SHIPPING_BASE + " kr.";
        updateCartCounter();
        saveCartToStorage();
        return;
      }

      let subtotal = 0;

      cart.forEach(function (item, index) {
        const priceNumeric = parseInt(String(item.price).replace(/\D/g, ""), 10) || 0;
        const lineTotal = priceNumeric * (item.qty || 0);
        subtotal += lineTotal;

        const wrapper = document.createElement("div");
        wrapper.className = "border-b border-gray-200 pb-2 mb-2 text-sm";

        const topRow = document.createElement("div");
        topRow.className = "flex justify-between items-center";

        const nameEl = document.createElement("span");
        nameEl.textContent = item.name;
        const priceEl = document.createElement("span");
        priceEl.textContent = lineTotal + " kr.";

        topRow.appendChild(nameEl);
        topRow.appendChild(priceEl);

        const metaRow = document.createElement("div");
        metaRow.className = "text-gray-500 text-xs mt-1";
        metaRow.textContent =
          t("cart_size_label") +
          ": " +
          item.size +
          " | " +
          t("cart_quantity_label") +
          ": " +
          item.qty;

        const removeBtn = document.createElement("button");
        removeBtn.className = "text-red-500 text-xs mt-1";
        removeBtn.textContent = t("cart_remove_label");
        removeBtn.addEventListener("click", function () {
          removeFromCart(index);
        });

        wrapper.appendChild(topRow);
        wrapper.appendChild(metaRow);
        wrapper.appendChild(removeBtn);

        cartItemsContainer.appendChild(wrapper);
      });

      cartSubtotalEl.textContent = subtotal + " kr.";

      const shippingCost = currentShippingCost();
      cartShippingLabelEl.textContent =
        shippingCost === 0 ? t("shipping_free_cph") : "+" + shippingCost + " kr.";

      const total = subtotal + shippingCost;
      cartTotalEl.textContent = total + " kr.";

      updateCartCounter();
      saveCartToStorage();
    }

    /**
     * Add an item to the cart.
     */
    function addToCart(name, priceLabel, size, quantity) {
      const qty = parseInt(quantity, 10);
      if (!name || !priceLabel || !size || !qty || qty <= 0) {
        return;
      }

      const existingIndex = cart.findIndex(function (item) {
        return item.name === name && item.size === size;
      });

      if (existingIndex >= 0) {
        cart[existingIndex].qty += qty;
      } else {
        cart.push({
          name: name,
          price: priceLabel,
          size: size,
          qty: qty
        });
      }

      renderCart();
      showPopup(t("popup_added"));
    }

    /**
     * Remove an item from the cart by index.
     */
    function removeFromCart(index) {
      if (index < 0 || index >= cart.length) return;
      cart.splice(index, 1);
      renderCart();
    }

    /**
     * Show a small popup in the top right corner with given text.
     */
    function showPopup(message) {
      const popup = document.createElement("div");
      popup.className = "popup";
      popup.textContent = message || "";
      document.body.appendChild(popup);

      // Trigger fade in.
      requestAnimationFrame(function () {
        popup.classList.add("show");
      });

      // Hide and remove after delay.
      setTimeout(function () {
        popup.classList.remove("show");
        setTimeout(function () {
          popup.remove();
        }, 300);
      }, 2000);
    }

    /**
     * Open the cart sidebar.
     */
    function openCartSidebar() {
      if (!cartSidebarEl || !cartOverlayEl) return;

      cartSidebarEl.classList.remove("translate-x-full");
      cartOverlayEl.classList.remove("hidden");

      if (globalNavButtons) {
        globalNavButtons.style.opacity = "0";
      }
      if (sepHeroButtonsEl) {
        sepHeroButtonsEl.style.opacity = "0";
      }
    }

    /**
     * Close the cart sidebar.
     */
    function closeCartSidebar() {
      if (!cartSidebarEl || !cartOverlayEl) return;

      cartSidebarEl.classList.add("translate-x-full");
      cartOverlayEl.classList.add("hidden");

      if (globalNavButtons) {
        globalNavButtons.style.opacity = "1";
      }
      if (sepHeroButtonsEl) {
        sepHeroButtonsEl.style.opacity = "1";
      }
    }

    /**
     * Initialise DOM references and event listeners for the SEP cart.
     */
    function initCartDom() {
      cartSidebarEl = document.getElementById("cartSidebar");
      cartOverlayEl = document.getElementById("cartOverlay");
      cartItemsContainer = document.getElementById("cartItems");
      cartSubtotalEl = document.getElementById("cartSubtotal");
      cartTotalEl = document.getElementById("cartTotal");
      cartShippingLabelEl = document.getElementById("cartShippingLabel");
      cartCounterEl = document.getElementById("cartCounter");
      sepHeroButtonsEl = document.getElementById("sepHeroButtons");
      shippingCphBtn = document.getElementById("shippingCph");
      shippingNonCphBtn = document.getElementById("shippingNonCph");
      openMobilePayBtn = document.getElementById("openMobilePay");
      copyMobilePayBtn = document.getElementById("copyMobilePay");

      const viewCartBtn = document.getElementById("viewCartBtn");
      const closeCartBtn = document.getElementById("closeCart");

      if (viewCartBtn) {
        viewCartBtn.addEventListener("click", function () {
          openCartSidebar();
        });
      }

      if (closeCartBtn) {
        closeCartBtn.addEventListener("click", function () {
          closeCartSidebar();
        });
      }

      if (cartOverlayEl) {
        cartOverlayEl.addEventListener("click", function () {
          closeCartSidebar();
        });
      }

      if (shippingCphBtn) {
        shippingCphBtn.addEventListener("click", function () {
          isCopenhagen = true;
          updateShippingButtonsAppearance();
          renderCart();
        });
      }

      if (shippingNonCphBtn) {
        shippingNonCphBtn.addEventListener("click", function () {
          isCopenhagen = false;
          updateShippingButtonsAppearance();
          renderCart();
        });
      }

      // Attach Add to cart events for each product card.
      const addButtons = document.querySelectorAll(".add-to-cart");
      addButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          const card = btn.closest(".product-card");
          if (!card) return;

          const nameEl = card.querySelector("h3");
          const priceEl = card.querySelector("p");
          const sizeSelect = card.querySelector("select");
          const qtyInput = card.querySelector(".quantity-selector");

          if (!nameEl || !priceEl || !sizeSelect || !qtyInput) return;

          const name = nameEl.textContent || "";
          const priceLabel = priceEl.textContent || "180 kr.";
          const size = sizeSelect.value || "M";
          const quantity = qtyInput.value || "1";

          addToCart(name, priceLabel, size, quantity);
        });
      });

      updateShippingButtonsAppearance();
      renderCart();
    }

    // ============================================
    // MOBILEPAY & COPY ORDER MESSAGE
    // ============================================

    const MOBILEPAY_ID = "5894BZ";

    /**
     * Try to open MobilePay via URL scheme on mobile devices.
     * Also show a small thank you alert.
     */
    function handleOpenMobilePay() {
      try {
        // This will only work on devices that know the "mobilepay://" scheme.
        window.location.href = "mobilepay://transfer?phone=" + MOBILEPAY_ID.replace(/\D/g, "");
      } catch (e) {
        // Ignore errors.
      }
      alert("Thank you for supporting SEP.");
    }

    /**
     * Build a clear text order summary for clipboard.
     */
    function buildOrderMessage() {
      const subtotalText = cartSubtotalEl ? cartSubtotalEl.textContent : "";
      const totalText = cartTotalEl ? cartTotalEl.textContent : "";
      const shippingText = cartShippingLabelEl ? cartShippingLabelEl.textContent : "";

      const lines = [];
      lines.push(t("order_greeting"));
      lines.push("");

      if (cart.length) {
        lines.push(t("order_label_items") + ":");
        cart.forEach(function (item) {
          lines.push(
            (item.qty || 0) +
              "× " +
              item.name +
              " (" +
              t("cart_size_label") +
              ": " +
              item.size +
              ")"
          );
        });
        lines.push("");
      }

      lines.push(t("order_label_subtotal") + ": " + subtotalText);
      lines.push(t("order_label_shipping") + ": " + shippingText);
      lines.push(t("order_label_total") + ": " + totalText);

      return lines.join("\n");
    }

    /**
     * Copy order message to clipboard and show popup.
     */
    function handleCopyOrderMessage() {
      const msg = buildOrderMessage();

      if (!navigator.clipboard || !navigator.clipboard.writeText) {
        // Simple fallback.
        const textarea = document.createElement("textarea");
        textarea.value = msg;
        textarea.style.position = "fixed";
        textarea.style.left = "-9999px";
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand("copy");
        } catch (e) {
          // Ignore.
        }
        textarea.remove();
        showPopup(t("popup_order_copied"));
        return;
      }

      navigator.clipboard.writeText(msg).then(
        function () {
          showPopup(t("popup_order_copied"));
        },
        function () {
          showPopup(t("popup_order_copied"));
        }
      );
    }

    /**
     * Initialise MobilePay and copy buttons.
     */
    function initMobilePayAndCopy() {
      if (openMobilePayBtn) {
        openMobilePayBtn.addEventListener("click", handleOpenMobilePay);
      }
      if (copyMobilePayBtn) {
        copyMobilePayBtn.addEventListener("click", handleCopyOrderMessage);
      }
    }

    // ============================================
    // END OF PART 3 - NEXT: MIH DATA & LOGIC
    // ============================================
    // ============================================
    // MAKE IT HAPPEN - DATA MODEL & HELPERS
    // ============================================

    // LocalStorage keys for MIH (movement challenge).
    const STORAGE_KEY_ENTRIES = "mih_entries_v5";
    const STORAGE_KEY_USERS = "mih_users_v5";
    const STORAGE_KEY_CURRENT_USER = "mih_current_user_v5";

    // In memory collections for MIH.
    let entries = [];
    let users = [];
    let currentUser = null;

    // League names in order.
    const LEAGUES = ["amateurs", "intermediates", "pros", "legends"];

    // 30 days in milliseconds.
    const THIRTY_DAYS_MS = 30 * 24 * 60 * 60 * 1000;

    /**
     * Generate a simple unique id.
     */
    function generateId() {
      return (
        Date.now().toString(36) +
        Math.random().toString(36).slice(2, 8)
      );
    }

    /**
     * Load entries from localStorage.
     */
    function loadEntries() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_ENTRIES);
        if (!raw) {
          entries = [];
          return;
        }
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
          entries = parsed;
        } else {
          entries = [];
        }
      } catch (e) {
        entries = [];
      }
    }

    /**
     * Save entries to localStorage.
     */
    function saveEntries() {
      try {
        localStorage.setItem(
          STORAGE_KEY_ENTRIES,
          JSON.stringify(entries)
        );
      } catch (e) {
        // Ignore.
      }
    }

    /**
     * Load users from localStorage.
     */
    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_USERS);
        if (!raw) {
          users = [];
        } else {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            users = parsed;
          } else {
            users = [];
          }
        }
      } catch (e) {
        users = [];
      }

      // Make sure each user has a valid league.
      users.forEach(function (user) {
        if (!user.league || LEAGUES.indexOf(user.league) === -1) {
          user.league = "amateurs";
        }
      });

      saveUsers();
    }

    /**
     * Save users to localStorage.
     */
    function saveUsers() {
      try {
        localStorage.setItem(
          STORAGE_KEY_USERS,
          JSON.stringify(users)
        );
      } catch (e) {
        // Ignore.
      }
    }

    /**
     * Get user by id.
     */
    function getUserById(id) {
      return users.find(function (u) {
        return u.id === id;
      }) || null;
    }

    /**
     * Get user by name (case insensitive).
     */
    function getUserByName(name) {
      const n = (name || "").toLowerCase();
      return (
        users.find(function (u) {
          return (u.name || "").toLowerCase() === n;
        }) || null
      );
    }

    /**
     * Choose the league that currently has the fewest users.
     */
    function assignStartingLeague() {
      const counts = {
        amateurs: 0,
        intermediates: 0,
        pros: 0,
        legends: 0
      };

      users.forEach(function (user) {
        if (user.league && counts.hasOwnProperty(user.league)) {
          counts[user.league] += 1;
        }
      });

      let bestLeague = "amateurs";
      let bestCount = Number.MAX_SAFE_INTEGER;

      LEAGUES.forEach(function (league) {
        const c = counts[league];
        if (c < bestCount) {
          bestCount = c;
          bestLeague = league;
        }
      });

      return bestLeague;
    }

    /**
     * Remove users and their entries if logged out for more than 30 days.
     * The currently logged in user is never removed here.
     */
    function cleanupOldAccounts() {
      const now = Date.now();
      const currentId = localStorage.getItem(STORAGE_KEY_CURRENT_USER);
      const keepUsers = [];
      const removedIds = [];

      users.forEach(function (user) {
        const isCurrent = user.id === currentId;

        if (!user.lastLogoutAt || isCurrent) {
          keepUsers.push(user);
          return;
        }

        const delta = now - user.lastLogoutAt;
        if (delta > THIRTY_DAYS_MS) {
          removedIds.push(user.id);
        } else {
          keepUsers.push(user);
        }
      });

      users = keepUsers;

      if (removedIds.length > 0) {
        entries = entries.filter(function (e) {
          return removedIds.indexOf(e.userId) === -1;
        });
      }

      saveUsers();
      saveEntries();
    }

    /**
     * Format timestamp as simple date.
     */
    function formatDate(ts) {
      const d = new Date(ts);
      if (isNaN(d.getTime())) {
        return "";
      }
      return d.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    /**
     * Format minutes as M:SS.
     */
    function formatMinutes(mins) {
      if (!mins || !isFinite(mins) || mins <= 0) {
        return "–";
      }
      const totalSeconds = Math.round(mins * 60);
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return (
        m.toString() +
        ":" +
        s.toString().padStart(2, "0")
      );
    }

    /**
     * Format improvement as a signed percentage string.
     */
    function formatImprovement(value) {
      if (!value || !isFinite(value) || value === 0) {
        return "0%";
      }
      const rounded = Math.round(value);
      const sign = rounded > 0 ? "+" : "";
      return sign + rounded + "%";
    }

    /**
     * Compute aggregated stats per user:
     *  - runs
     *  - totalDistance
     *  - totalTime
     *  - avgDistance
     *  - bestDistance
     *  - improvement (based on distance and pace vs first run)
     */
    function getPlayerStats() {
      const byUser = {};

      // Seed map with users.
      users.forEach(function (user) {
        byUser[user.id] = {
          userId: user.id,
          name: user.name,
          league: user.league || "amateurs",
          runs: 0,
          totalDistance: 0,
          totalTime: 0,
          bestDistance: 0,
          baselineDistance: null,
          baselineTime: null
        };
      });

      // Aggregate entries.
      entries.forEach(function (entry) {
        const user = getUserById(entry.userId);
        if (!user) return;

        const stats = byUser[user.id];
        if (!stats) return;

        if (stats.runs === 0) {
          stats.baselineDistance = entry.distanceKm;
          stats.baselineTime = entry.timeMinutes;
        }

        stats.runs += 1;
        stats.totalDistance += entry.distanceKm;
        stats.totalTime += entry.timeMinutes;

        if (entry.distanceKm > stats.bestDistance) {
          stats.bestDistance = entry.distanceKm;
        }
      });

      // Turn into an array and compute derived values.
      let players = Object.values(byUser);

      players.forEach(function (p) {
        p.avgDistance =
          p.runs > 0 ? p.totalDistance / p.runs : 0;
        p.avgPace =
          p.totalDistance > 0
            ? p.totalTime / p.totalDistance
            : null;

        let distImp = 0;
        if (
          p.baselineDistance &&
          p.runs > 1
        ) {
          distImp =
            ((p.avgDistance - p.baselineDistance) /
              p.baselineDistance) *
            100;
        }

        let paceImp = 0;
        if (
          p.baselineTime &&
          p.baselineDistance &&
          p.runs > 1 &&
          p.avgPace
        ) {
          const basePace =
            p.baselineTime / p.baselineDistance;
          if (basePace > 0) {
            paceImp =
              ((basePace - p.avgPace) / basePace) * 100;
          }
        }

        p.improvement = distImp + paceImp;
      });

      // Sort players by:
      //  1. totalDistance (desc)
      //  2. runs (desc)
      //  3. speed (distance/time) (desc)
      //  4. totalTime (asc)
      players.sort(function (a, b) {
        if (b.totalDistance !== a.totalDistance) {
          return b.totalDistance - a.totalDistance;
        }
        if (b.runs !== a.runs) {
          return b.runs - a.runs;
        }
        const aSpeed =
          a.totalTime > 0
            ? a.totalDistance / a.totalTime
            : 0;
        const bSpeed =
          b.totalTime > 0
            ? b.totalDistance / b.totalTime
            : 0;
        if (bSpeed !== aSpeed) {
          return bSpeed - aSpeed;
        }
        return a.totalTime - b.totalTime;
      });

      // Apply ranks starting from 1.
      players = players.map(function (p, index) {
        return Object.assign({}, p, {
          rank: index + 1
        });
      });

      return players;
    }

    // ============================================
    // MIH - UI RENDERING FUNCTIONS
    // ============================================

    /**
     * Update header user controls in leaderboard header.
     */
    function renderHeaderUser() {
      const controls = document.getElementById("user-controls");
      const nameInput = document.getElementById("name");

      if (!controls) return;

      controls.innerHTML = "";

      if (!currentUser) {
        const status = document.createElement("span");
        status.id = "user-status";
        status.textContent = "Not logged in";
        controls.appendChild(status);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className =
          "px-3 py-1 rounded-full border border-white/20 text-[11px] text-gray-300";
        btn.textContent = "Log in";
        btn.addEventListener("click", function () {
          showScene("mih-login");
        });
        controls.appendChild(btn);

        if (nameInput) {
          nameInput.value = "";
          nameInput.placeholder = "Log in to set your name";
        }
        return;
      }

      const status = document.createElement("span");
      status.id = "user-status";
      status.innerHTML =
        'Logged in as <span class="font-semibold">' +
        (currentUser.name || "") +
        "</span> · " +
        '<span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">' +
        (currentUser.league || "amateurs")
          .charAt(0)
          .toUpperCase() +
        (currentUser.league || "amateurs").slice(1) +
        "</span>";
      controls.appendChild(status);

      const logoutBtn = document.createElement("button");
      logoutBtn.type = "button";
      logoutBtn.className =
        "px-3 py-1 rounded-full border border-white/20 text-[11px] text-gray-300";
      logoutBtn.textContent = "Log out";
      logoutBtn.addEventListener("click", logout);
      controls.appendChild(logoutBtn);

      const deleteBtn = document.createElement("button");
      deleteBtn.type = "button";
      deleteBtn.className =
        "px-3 py-1 rounded-full border border-red-400/60 text-[11px] text-red-200";
      deleteBtn.textContent = "Delete account";
      deleteBtn.addEventListener("click", deleteAccount);
      controls.appendChild(deleteBtn);

      if (nameInput) {
        nameInput.value = currentUser.name || "";
        nameInput.placeholder = "";
      }
    }

    /**
     * Render leaderboard table.
     */
    function renderLeaderboard() {
      const tbody = document.getElementById("leaderboard-body");
      const empty = document.getElementById("no-entries");
      const leagueFilter = document.getElementById("league-filter");

      if (!tbody) return;

      tbody.innerHTML = "";

      const players = getPlayerStats();
      let filtered = players;

      if (leagueFilter && leagueFilter.value !== "all") {
        const selectedLeague = leagueFilter.value;
        filtered = players.filter(function (p) {
          return p.league === selectedLeague;
        });
      }

      if (!filtered.length) {
        if (empty) {
          empty.style.display = "block";
        }
        return;
      }

      if (empty) {
        empty.style.display = "none";
      }

      filtered.forEach(function (player) {
        const tr = document.createElement("tr");
        tr.className = "border-b border-white/10";

        let rankSymbol = player.rank;
        if (player.rank === 1) {
          rankSymbol = "🥇";
        } else if (player.rank === 2) {
          rankSymbol = "🥈";
        } else if (player.rank === 3) {
          rankSymbol = "🥉";
        }

        tr.innerHTML =
          '<td class="py-2 pr-2">' +
          rankSymbol +
          "</td>" +
          '<td class="py-2 px-2">' +
          '<button type="button" class="underline text-gray-200 text-xs md:text-sm" onclick="openProfile(\'' +
          player.userId +
          "')\">" +
          player.name +
          "</button>" +
          "</td>" +
          '<td class="py-2 px-2">' +
          '<span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">' +
          player.league.charAt(0).toUpperCase() +
          player.league.slice(1) +
          "</span>" +
          "</td>" +
          '<td class="py-2 px-2">' +
          player.totalDistance.toFixed(2) +
          " km</td>" +
          '<td class="py-2 px-2">' +
          player.totalTime.toFixed(1) +
          " min</td>";

        tbody.appendChild(tr);
      });
    }

    /**
     * Render stats table.
     */
    function renderStats() {
      const tbody = document.getElementById("stats-body");
      const empty = document.getElementById("no-stats");

      if (!tbody) return;

      tbody.innerHTML = "";

      if (!users.length) {
        if (empty) {
          empty.style.display = "block";
        }
        return;
      }

      if (empty) {
        empty.style.display = "none";
      }

      const players = getPlayerStats();

      players.forEach(function (stats) {
        const tr = document.createElement("tr");
        tr.className = "border-b border-white/10";

        tr.innerHTML =
          '<td class="py-2 px-2">' +
          stats.name +
          "</td>" +
          '<td class="py-2 px-2">' +
          '<span class="px-2 py-0.5 rounded-full border border-white/25 text-[10px] uppercase tracking-wide">' +
          stats.league.charAt(0).toUpperCase() +
          stats.league.slice(1) +
          "</span>" +
          "</td>" +
          '<td class="py-2 px-2">' +
          stats.runs +
          "</td>" +
          '<td class="py-2 px-2">' +
          stats.totalDistance.toFixed(2) +
          " km</td>" +
          '<td class="py-2 px-2">' +
          stats.totalTime.toFixed(1) +
          " min</td>" +
          '<td class="py-2 px-2">' +
          stats.avgDistance.toFixed(2) +
          " km</td>" +
          '<td class="py-2 px-2">' +
          stats.bestDistance.toFixed(2) +
          " km</td>" +
          '<td class="py-2 px-2">' +
          formatImprovement(stats.improvement) +
          "</td>";

        tbody.appendChild(tr);
      });
    }

    /**
     * Render "My activities" table.
     */
    function renderMyActivities() {
      const tbody = document.getElementById("my-activities-body");
      const empty = document.getElementById("no-my-activities");

      if (!tbody) return;

      tbody.innerHTML = "";

      if (!currentUser) {
        if (empty) {
          empty.style.display = "block";
          empty.textContent =
            "Log in to see and manage your activities.";
        }
        return;
      }

      const myEntries = entries.filter(function (e) {
        return e.userId === currentUser.id;
      });

      if (!myEntries.length) {
        if (empty) {
          empty.style.display = "block";
          empty.textContent =
            "No activities yet for this account.";
        }
        return;
      }

      if (empty) {
        empty.style.display = "none";
      }

      myEntries
        .slice()
        .sort(function (a, b) {
          return b.timestamp - a.timestamp;
        })
        .forEach(function (e) {
          const tr = document.createElement("tr");
          tr.className = "border-b border-white/10";

          tr.innerHTML =
            '<td class="py-2 px-2">' +
            formatDate(e.timestamp) +
            "</td>" +
            '<td class="py-2 px-2">' +
            e.distanceKm.toFixed(2) +
            " km</td>" +
            '<td class="py-2 px-2">' +
            e.timeMinutes.toFixed(1) +
            " min</td>" +
            '<td class="py-2 px-2 text-right">' +
            '<button type="button" class="text-[11px] text-red-300 underline" onclick="deleteActivity(\'' +
            e.id +
            "')\">Delete</button>" +
            "</td>";

          tbody.appendChild(tr);
        });
    }

    /**
     * Delete an activity (if it belongs to current user).
     */
    function deleteActivity(id) {
      if (!currentUser) {
        alert("You need to be logged in to delete activities.");
        return;
      }

      const entry = entries.find(function (e) {
        return e.id === id;
      });

      if (!entry) return;

      if (entry.userId !== currentUser.id) {
        alert("You can only delete your own activities.");
        return;
      }

      if (!confirm("Delete this activity?")) {
        return;
      }

      entries = entries.filter(function (e) {
        return e.id !== id;
      });

      saveEntries();
      renderLeaderboard();
      renderStats();
      renderMyActivities();
    }

    /**
     * Open profile screen for a given userId.
     */
    function openProfile(userId) {
      const user = getUserById(userId);
      if (!user) return;

      const userEntries = entries.filter(function (e) {
        return e.userId === userId;
      });

      let totalDist = 0;
      let totalTime = 0;

      userEntries.forEach(function (e) {
        totalDist += e.distanceKm;
        totalTime += e.timeMinutes;
      });

      const runs = userEntries.length;
      const avgDist =
        runs > 0 ? totalDist / runs : 0;
      const avgPace =
        totalDist > 0 ? totalTime / totalDist : null;

      let best5k = null;
      let best10k = null;
      let best100m = null;

      if (avgPace) {
        best5k = avgPace * 5;
        best10k = avgPace * 10;
        best100m = avgPace * 0.1;
      }

      const profileName = document.getElementById("profileName");
      const profileLeague = document.getElementById("profileLeague");
      const profileTotalDistance = document.getElementById("profileTotalDistance");
      const profileTotalTime = document.getElementById("profileTotalTime");
      const profileRuns = document.getElementById("profileRuns");
      const profileAvgDistance = document.getElementById("profileAvgDistance");
      const profileBest5k = document.getElementById("profileBest5k");
      const profileBest10k = document.getElementById("profileBest10k");
      const profileBest100m = document.getElementById("profileBest100m");

      if (profileName) {
        profileName.textContent = user.name || "Runner profile";
      }
      if (profileLeague) {
        profileLeague.textContent =
          "League: " +
          (user.league || "amateurs")
            .charAt(0)
            .toUpperCase() +
          (user.league || "amateurs").slice(1);
      }
      if (profileTotalDistance) {
        profileTotalDistance.textContent =
          totalDist.toFixed(2) + " km";
      }
      if (profileTotalTime) {
        profileTotalTime.textContent =
          totalTime.toFixed(1) + " min";
      }
      if (profileRuns) {
        profileRuns.textContent = runs.toString();
      }
      if (profileAvgDistance) {
        profileAvgDistance.textContent = runs
          ? avgDist.toFixed(2) + " km"
          : "–";
      }
      if (profileBest5k) {
        profileBest5k.textContent = best5k
          ? formatMinutes(best5k)
          : "–";
      }
      if (profileBest10k) {
        profileBest10k.textContent = best10k
          ? formatMinutes(best10k)
          : "–";
      }
      if (profileBest100m) {
        profileBest100m.textContent = best100m
          ? formatMinutes(best100m)
          : "–";
      }

      showScene("mih-profile");
    }

    // ============================================
    // MIH - AUTHENTICATION
    // ============================================

    /**
     * Log in or create account.
     */
    function login(name, password) {
      const trimmedName = (name || "").trim();
      if (!trimmedName || !password) {
        alert("Please enter both name and password.");
        return;
      }

      let user = getUserByName(trimmedName);

      if (!user) {
        const league = assignStartingLeague();
        user = {
          id: generateId(),
          name: trimmedName,
          password: password,
          league: league,
          createdAt: Date.now(),
          lastLoginAt: Date.now(),
          lastLogoutAt: null
        };
        users.push(user);
      } else {
        if (user.password !== password) {
          alert("Wrong password for this name.");
          return;
        }
        user.lastLoginAt = Date.now();
        if (
          !user.league ||
          LEAGUES.indexOf(user.league) === -1
        ) {
          user.league = "amateurs";
        }
      }

      currentUser = user;
      saveUsers();

      try {
        localStorage.setItem(
          STORAGE_KEY_CURRENT_USER,
          user.id
        );
      } catch (e) {
        // Ignore.
      }

      renderHeaderUser();
      renderMyActivities();
      renderLeaderboard();
      renderStats();

      showScene("mih-welcome");
    }

    /**
     * Logout current user.
     */
    function logout() {
      if (!currentUser) return;

      const user = getUserById(currentUser.id);
      if (user) {
        user.lastLogoutAt = Date.now();
        saveUsers();
      }

      currentUser = null;

      try {
        localStorage.removeItem(
          STORAGE_KEY_CURRENT_USER
        );
      } catch (e) {
        // Ignore.
      }

      renderHeaderUser();
      renderMyActivities();
      showScene("mih-login");
    }

    /**
     * Delete account and its entries.
     */
    function deleteAccount() {
      if (!currentUser) return;

      if (
        !confirm(
          "This will delete your account and all your activities. Are you sure?"
        )
      ) {
        return;
      }

      const id = currentUser.id;

      users = users.filter(function (u) {
        return u.id !== id;
      });
      entries = entries.filter(function (e) {
        return e.userId !== id;
      });

      saveUsers();
      saveEntries();

      try {
        localStorage.removeItem(
          STORAGE_KEY_CURRENT_USER
        );
      } catch (e) {
        // Ignore.
      }

      currentUser = null;

      renderHeaderUser();
      renderLeaderboard();
      renderStats();
      renderMyActivities();

      showScene("mih-login");
    }

    // ============================================
    // MIH - FORM LISTENERS
    // ============================================

    /**
     * Initialise MIH forms (login and entry).
     */
    function initMihForms() {
      const loginForm = document.getElementById("login-form");
      const entryForm = document.getElementById("entry-form");

      if (loginForm) {
        loginForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const nameInput = document.getElementById("login-name");
          const pwInput = document.getElementById("login-password");

          const nameVal = nameInput ? nameInput.value : "";
          const pwVal = pwInput ? pwInput.value : "";

          login(nameVal, pwVal);

          loginForm.reset();
        });
      }

      if (entryForm) {
        entryForm.addEventListener("submit", function (e) {
          e.preventDefault();

          if (!currentUser) {
            alert("Please log in before adding activities.");
            showScene("mih-login");
            return;
          }

          const distInput = document.getElementById("distance");
          const timeInput = document.getElementById("time");

          if (!distInput || !timeInput) return;

          const distance = parseFloat(distInput.value);
          const time = parseFloat(timeInput.value);

          if (
            isNaN(distance) ||
            isNaN(time) ||
            distance <= 0 ||
            time <= 0
          ) {
            alert("Please fill in distance and time correctly.");
            return;
          }

          entries.push({
            id: generateId(),
            userId: currentUser.id,
            distanceKm: distance,
            timeMinutes: time,
            timestamp: Date.now()
          });

          saveEntries();
          renderLeaderboard();
          renderStats();
          renderMyActivities();

          entryForm.reset();
          showScene("mih-leaderboard");
        });
      }
    }

    // ============================================
    // GSAP ANIMATIONS
    // ============================================

    /**
     * Initialise GSAP fade in animations for .fade-section elements.
     */
    function initGsapAnimations() {
      if (typeof gsap === "undefined" || typeof ScrollTrigger === "undefined") {
        return;
      }

      gsap.registerPlugin(ScrollTrigger);

      const sections = document.querySelectorAll(".fade-section");
      sections.forEach(function (sec) {
        gsap.fromTo(
          sec,
          {
            opacity: 0,
            y: 30
          },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: "power2.out",
            scrollTrigger: {
              trigger: sec,
              start: "top 80%",
              once: true
            }
          }
        );
      });
    }

    // ============================================
    // INIT ALL
    // ============================================

    /**
     * Overall initialisation.
     *  - language
     *  - cart
     *  - MobilePay + copy message
     *  - MIH data and UI
     *  - GSAP animations
     */
    function initAll() {
      // Language for SEP.
      initLanguage();

      // Cart.
      loadCartFromStorage();
      initCartDom();
      initMobilePayAndCopy();

      // MIH.
      loadEntries();
      loadUsers();
      cleanupOldAccounts();

      // Restore current user, if any.
      try {
        const currentId = localStorage.getItem(
          STORAGE_KEY_CURRENT_USER
        );
        if (currentId) {
          const user = getUserById(currentId);
          if (user) {
            currentUser = user;
          }
        }
      } catch (e) {
        // Ignore.
      }

      renderHeaderUser();
      renderLeaderboard();
      renderStats();
      renderMyActivities();
      initMihForms();

      // GSAP.
      initGsapAnimations();
    }

    // Run initAll when the window loads to ensure DOM is ready.
    window.addEventListener("load", initAll);
  </script>

</body>
</html>
